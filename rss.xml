<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="assets/xml/rss.xsl" media="all"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Louis Tiao</title><link>http://louistiao.me/</link><description>Computer Science / Math / Software Engineering</description><atom:link type="application/rss+xml" rel="self" href="http://louistiao.me/rss.xml"></atom:link><language>en</language><lastBuildDate>Fri, 01 Jul 2016 04:13:14 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Walkthrough: Deploying a Flask app with Redis Queue (RQ) Workers and Dashboard using Kubernetes</title><link>http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;img alt="../../images/rq-dashboard.png" class="align-center" src="http://louistiao.me/images/rq-dashboard.png"&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title first"&gt;Contents&lt;/p&gt;
&lt;ul class="auto-toc simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#deploy-the-redis-master" id="id4"&gt;1   Deploy the Redis master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#deploy-the-flask-web-app" id="id5"&gt;2   Deploy the Flask web app&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#requirements-txt" id="id6"&gt;2.1   requirements.txt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#settings-py" id="id7"&gt;2.2   settings.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#app-py" id="id8"&gt;2.3   app.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#dockerfile" id="id9"&gt;2.4   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#web-flask-deployment-yaml" id="id10"&gt;2.5   web-flask-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#web-flask-service-yaml" id="id11"&gt;2.6   web-flask-service.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#deploy-the-redis-queue-rq-workers" id="id12"&gt;3   Deploy the Redis Queue (RQ) workers&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id1" id="id13"&gt;3.1   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-worker-deployment-yaml" id="id14"&gt;3.2   rq-worker-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#testing-it-out" id="id15"&gt;4   Testing it out&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-dashboard-optional" id="id16"&gt;5   RQ Dashboard (Optional)&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id2" id="id17"&gt;5.1   requirements.txt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id3" id="id18"&gt;5.2   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-dashboard-deployment-yaml" id="id19"&gt;5.3   rq-dashboard-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-dashboard-service-yaml" id="id20"&gt;5.4   rq-dashboard-service.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#alternative-solution-integrate-the-dashboard-in-our-flask-app" id="id21"&gt;5.5   Alternative Solution: Integrate the Dashboard in our Flask app&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_83ee9834a60741c885505f146f114174-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir flask-redis-queue
&lt;a name="rest_code_83ee9834a60741c885505f146f114174-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; flask-redis-queue
&lt;/pre&gt;&lt;div class="section" id="deploy-the-redis-master"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id4"&gt;1   Deploy the Redis master&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run redis-master --image&lt;span class="o"&gt;=&lt;/span&gt;redis --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;6379&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=redis,role=master,tier=backend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; redis-master-deployment.yaml
&lt;/pre&gt;&lt;pre class="code yaml"&gt;&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-28"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-29"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-30"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-32"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-33"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-35"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_9f5f95e803cb42ae94f8edf7d916b92a-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f redis-master-deployment.yaml
&lt;a name="rest_code_9f5f95e803cb42ae94f8edf7d916b92a-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "redis-master" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_8e7aa77a72f1498aa2f13c826201b87b-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment redis-master --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=redis,role=master,tier=backend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_8e7aa77a72f1498aa2f13c826201b87b-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                        --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; redis-master-service.yaml
&lt;/pre&gt;&lt;pre class="code yaml"&gt;&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-12"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-14"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-18"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-19"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-20"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d40016f0c8fd4ba09410b0f17652d428-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f redis-master-service.yaml
&lt;a name="rest_code_d40016f0c8fd4ba09410b0f17652d428-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "redis-master" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="deploy-the-flask-web-app"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id5"&gt;2   Deploy the Flask web app&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_739818d6f12d4e6080290a4342cd1bf9-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir web-flask
&lt;/pre&gt;&lt;div class="section" id="requirements-txt"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id6"&gt;2.1   requirements.txt&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;gt; web-flask/requirements.txt
&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="settings-py"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id7"&gt;2.2   settings.py&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_35a831a5e2b240de8d0b06be2fdbaa06-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/settings.py
&lt;/pre&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-3"&gt;&lt;/a&gt;&lt;span class="n"&gt;REDIS_HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'REDIS_MASTER_SERVICE_HOST'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; \
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-4"&gt;&lt;/a&gt;          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GET_HOSTS_FROM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'env'&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="s1"&gt;'redis-master'&lt;/span&gt;
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-5"&gt;&lt;/a&gt;&lt;span class="n"&gt;REDIS_PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;6379&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="app-py"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id8"&gt;2.3   app.py&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_1c0e903998d0439faa17e5a6a52dde02-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/app.py
&lt;/pre&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-2"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;redis&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StrictRedis&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-3"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rq&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Queue&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-4"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-5"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;randrange&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-7"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;settings&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;REDIS_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;REDIS_PORT&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-10"&gt;&lt;/a&gt;&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-12"&gt;&lt;/a&gt;&lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;StrictRedis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;REDIS_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;REDIS_PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-14"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-15"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-16"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_randrange&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-18"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;'stop'&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-19"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-20"&gt;&lt;/a&gt;        &lt;span class="n"&gt;stop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'stop'&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-21"&gt;&lt;/a&gt;        &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'start'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-22"&gt;&lt;/a&gt;        &lt;span class="n"&gt;step&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'step'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-23"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-24"&gt;&lt;/a&gt;        &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enqueue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randrange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result_ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-25"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-26"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_id&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-27"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-28"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Stop value not specified!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-29"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-30"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-31"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"/results"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-32"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"/results/&amp;lt;string:job_id&amp;gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-33"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_results&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-34"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-35"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job_id&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-36"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queued_job_ids&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;job_ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-37"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-38"&gt;&lt;/a&gt;    &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetch_job&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-39"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-40"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-41"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Job has failed!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-42"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-43"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_finished&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-44"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-45"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-46"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Job has not finished!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;202&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-47"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-48"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'__main__'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-49"&gt;&lt;/a&gt;    &lt;span class="c1"&gt;# Start server&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-50"&gt;&lt;/a&gt;    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'0.0.0.0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8080&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="dockerfile"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id9"&gt;2.4   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_3d0dc6a1374f400dbd30c7dc7b906b89-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/Dockerfile
&lt;/pre&gt;&lt;div class="attention"&gt;
&lt;p class="first admonition-title"&gt;Attention!&lt;/p&gt;
&lt;p class="last"&gt;Not suitable for production!&lt;/p&gt;
&lt;/div&gt;
&lt;pre class="code docker"&gt;&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; python:3.5.1-onbuild&lt;/span&gt;
&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 8080&lt;/span&gt;
&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["python", "app.py"]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_546de6d0f8bf4497b5c87a6cc2a52234-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/web-flask-rq:v1 web-flask
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run web-flask --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/web-flask-rq:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=flask,tier=frontend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=dns"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; web-flask-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="web-flask-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id10"&gt;2.5   web-flask-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-8"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-9"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-10"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-12"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-13"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-16"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-18"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-19"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-20"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-21"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-22"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-23"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-24"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-25"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-26"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dns&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-27"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-28"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-29"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-30"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-32"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-33"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-35"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_dc0df61b1d1e4c849d13d59af8d1bffe-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f web-flask-deployment.yaml
&lt;a name="rest_code_dc0df61b1d1e4c849d13d59af8d1bffe-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "web-flask" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_05e0127bf2464ced90209d7e07765daa-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment web-flask --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=flask,tier=frontend'&lt;/span&gt; --type&lt;span class="o"&gt;=&lt;/span&gt;NodePort &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_05e0127bf2464ced90209d7e07765daa-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                     --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; web-flask-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="web-flask-service-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id11"&gt;2.6   web-flask-service.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-8"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-9"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-10"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-11"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-12"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-14"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-15"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;type&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NodePort&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-18"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-19"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f web-flask-service.yaml
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;You have exposed your service on an external port on all nodes in your&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;cluster.  If you want to expose this service to the external internet, you may&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;need to set up firewall rules for the service port(s) (tcp:30321) to serve traffic.&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-5"&gt;&lt;/a&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "web-flask" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="deploy-the-redis-queue-rq-workers"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id12"&gt;3   Deploy the Redis Queue (RQ) workers&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_dbf988d5a703469cbbc875f3ef0d1361-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir rq-worker
&lt;/pre&gt;&lt;div class="section" id="id1"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id13"&gt;3.1   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code docker"&gt;&lt;a name="rest_code_97ffb0ab0f1645c7946d4824256f5172-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_97ffb0ab0f1645c7946d4824256f5172-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_97ffb0ab0f1645c7946d4824256f5172-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["rq", "worker", "--config", "settings"]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d50731a6aaac439cba0ff9bd7264f1b4-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/rq-worker:v1 rq-worker
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run rq-worker --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/rq-worker:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"app=rq,role=worker,tier=backend"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"cpu=100m,memory=100Mi"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=dns"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-worker-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-worker-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id14"&gt;3.2   rq-worker-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-28"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-29"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dns&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-30"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/rq-worker:v1&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-32"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-33"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-35"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-36"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_9fe517f1df0648379fc246092c7f21cf-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-worker-deployment.yaml
&lt;a name="rest_code_9fe517f1df0648379fc246092c7f21cf-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "rq-worker" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="testing-it-out"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id15"&gt;4   Testing it out&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We make make use of &lt;a class="reference external" href="http://kubernetes.io/docs/user-guide/jsonpath/"&gt;JSONPath support&lt;/a&gt;
in the &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; tool to query the &lt;tt class="docutils literal"&gt;NodePort&lt;/tt&gt; for our &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;web-flask&lt;/span&gt;&lt;/tt&gt; service:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_6ca2ce62faad4d73969ef8e4c0ea5b7f-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get service web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;
&lt;a name="rest_code_6ca2ce62faad4d73969ef8e4c0ea5b7f-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;30321%&lt;/span&gt;
&lt;a name="rest_code_6ca2ce62faad4d73969ef8e4c0ea5b7f-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;kubectl get service web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;We construct the address for ease of reference later on:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_e60824d57c4c4c218ee52544930ae33c-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;minikube ip&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="nv"&gt;$port&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;a name="rest_code_e60824d57c4c4c218ee52544930ae33c-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$address&lt;/span&gt;
&lt;a name="rest_code_e60824d57c4c4c218ee52544930ae33c-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;192.168.99.101:31637&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_c072447e72b84fc7b013efe43935a221-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=23&amp;amp;stop=31"&lt;/span&gt;
&lt;/pre&gt;&lt;img alt="../../images/flask-rq-job.png" class="align-center" src="http://louistiao.me/images/flask-rq-job.png"&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_148c1db7088440318c3531a046aad632-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=41&amp;amp;stop=45"&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;{&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;  "job_id": "cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;}&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=41&amp;amp;stop=45"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.job_id'&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;"cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;{&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;  "result": 43&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;}&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.result'&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;43&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=53&amp;amp;stop=45"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.job_id'&lt;/span&gt;
&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;"252b14a4-4a9e-45eb-8834-9e2078fb94ed"&lt;/span&gt;
&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/252b14a4-4a9e-45eb-8834-9e2078fb94ed"&lt;/span&gt;
&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;Job has failed!%&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-optional"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id16"&gt;5   RQ Dashboard (Optional)&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_206689f8238e4ec68caca346d6e9a813-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir rq-dashboard
&lt;/pre&gt;&lt;div class="section" id="id2"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id17"&gt;5.1   requirements.txt&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_afc0bc4c34124fc882e63c51d7426e1d-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; rq-dashboard &amp;gt; rq-dashboard/requirements.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id18"&gt;5.2   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_87048734db9c4d97bf47667028365c35-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; rq-dashboard/Dockerfile
&lt;/pre&gt;&lt;pre class="code docker"&gt;&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; python:3.5.1-onbuild&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 9181&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["rq-dashboard", "--port", "9181", \&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-5"&gt;&lt;/a&gt;                     &lt;span class="s2"&gt;"--redis-host"&lt;/span&gt;, &lt;span class="s2"&gt;"redis-master"&lt;/span&gt;, &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-6"&gt;&lt;/a&gt;                     &lt;span class="s2"&gt;"--redis-port"&lt;/span&gt;, &lt;span class="s2"&gt;"6379"&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_a309739c23f14970b6075af4f65c6e84-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/rq-dashboard:v1 rq-dashboard
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run rq-dashboard --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/rq-dashboard:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9181&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=rq,role=dashboard,tier=frontend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=env"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-dashboard-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id19"&gt;5.3   rq-dashboard-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-28"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-29"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-30"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/rq-dashboard:v1&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-32"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-33"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-34"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-35"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-36"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-37"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-38"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_334129999dec4101aadecc7dfae2fbbf-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-dashboard-deployment.yaml
&lt;a name="rest_code_334129999dec4101aadecc7dfae2fbbf-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "rq-dashboard" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_12162d355d4b487a92726cf456d11e58-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment rq-dashboard --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=rq,role=dashboard,tier=frontend'&lt;/span&gt; --type&lt;span class="o"&gt;=&lt;/span&gt;NodePort &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_12162d355d4b487a92726cf456d11e58-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                        --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-dashboard-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-service-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id20"&gt;5.4   rq-dashboard-service.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-12"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-14"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-18"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-19"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;type&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NodePort&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-20"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-21"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-dashboard-service.yaml
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;You have exposed your service on an external port on all nodes in your&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;cluster.  If you want to expose this service to the external internet, you may&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;need to set up firewall rules for the service port(s) (tcp:30645) to serve traffic.&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-5"&gt;&lt;/a&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "rq-dashboard" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_a8596bd656834bbd9a8cf696ef024455-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;minikube ip&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;kubectl get service rq-dashboard --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;/pre&gt;&lt;a class="reference external image-reference" href="http://louistiao.me/images/rq-dashboard-failed.png"&gt;&lt;img alt="../../images/rq-dashboard-failed.thumbnail.png" class="align-center" src="http://louistiao.me/images/rq-dashboard-failed.thumbnail.png"&gt;&lt;/a&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get pods
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;NAME                            READY     STATUS    RESTARTS   AGE&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;redis-master-2576299852-iwf15   1/1       Running   0          52m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-dashboard-1288919851-n10qs   1/1       Running   0          20m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-5"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-bekby      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-cecxu      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-lnxha      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-8"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-nc474      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-9"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-ztmuq      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-10"&gt;&lt;/a&gt;&lt;span class="go"&gt;web-flask-338777398-21dli       1/1       Running   0          47m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="alternative-solution-integrate-the-dashboard-in-our-flask-app"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id21"&gt;5.5   Alternative Solution: Integrate the Dashboard in our Flask app&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code diff"&gt;&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask/app.py b/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index af6ec48..ec7c1cd 100644&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -4,12 +4,16 @@ from rq import Queue&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-7"&gt;&lt;/a&gt; from random import randrange
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-9"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-from settings import REDIS_HOST, REDIS_PORT&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-10"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-11"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+import rq_dashboard&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-12"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+import settings&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-14"&gt;&lt;/a&gt; app = Flask(__name__)
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-15"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.config.from_object(rq_dashboard.default_settings)&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-16"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.config.from_object(settings)&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-17"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.register_blueprint(rq_dashboard.blueprint, url_prefix='/dashboard')&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-18"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-19"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-q = Queue(connection=StrictRedis(host=REDIS_HOST, port=REDIS_PORT))&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-20"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+q = Queue(connection=StrictRedis(host=settings.REDIS_HOST,&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-21"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+                                 port=settings.REDIS_PORT))&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code diff"&gt;&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask/requirements.txt b/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index 17dba2a..fcb5d58 100644&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -1,3 +1,4 @@&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-6"&gt;&lt;/a&gt; flask
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-7"&gt;&lt;/a&gt; redis
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-8"&gt;&lt;/a&gt; rq
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-9"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+rq-dashboard&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_173d394afbe0465bb6acc2328736e358-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/web-flask-rq:v2 web-flask
&lt;/pre&gt;&lt;pre class="code diff"&gt;&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask-deployment.yaml b/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index a4524e6..2dc5356 100644&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -24,7 +24,7 @@ spec:&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-6"&gt;&lt;/a&gt;       - env:
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-7"&gt;&lt;/a&gt;         - name: GET_HOSTS_FROM
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-8"&gt;&lt;/a&gt;           value: dns
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-9"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-        image: tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-10"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+        image: tiao/web-flask-rq:v2&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-11"&gt;&lt;/a&gt;         name: web-flask
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-12"&gt;&lt;/a&gt;         ports:
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-13"&gt;&lt;/a&gt;         - containerPort: 8080
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_3abb47cbc4d94b6cabd44b8aa473e5fe-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl apply -f web-flask-deployment.yaml
&lt;a name="rest_code_3abb47cbc4d94b6cabd44b8aa473e5fe-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "web-flask" configured&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d7bb0e09c0ef40c7ba791d558aa789f4-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get deployment web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.template.spec.containers[*].image}'&lt;/span&gt;
&lt;a name="rest_code_d7bb0e09c0ef40c7ba791d558aa789f4-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;tiao/web-flask-rq:v2%&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_ca1bc62c1a5e480499a6047402d39f02-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/dashboard"&lt;/span&gt;
&lt;/pre&gt;&lt;a class="reference external image-reference" href="http://louistiao.me/images/rq-dashboard-failed-flask.png"&gt;&lt;img alt="../../images/rq-dashboard-failed-flask.thumbnail.png" class="align-center" src="http://louistiao.me/images/rq-dashboard-failed-flask.thumbnail.png"&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>docker</category><category>flask</category><category>jsonpath</category><category>kubernetes</category><category>redis</category><category>rq</category><category>yaml</category><guid>http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/</guid><pubDate>Fri, 01 Jul 2016 04:12:07 GMT</pubDate></item><item><title>Re-implementing the Kubernetes Guestbook Example with Flask and NGINX</title><link>http://louistiao.me/posts/re-implementing-the-kubernetes-guestbook-example-with-flask-and-nginx/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;The official &lt;a class="reference external" href="http://kubernetes.io/"&gt;Kubernetes&lt;/a&gt; &lt;a class="reference external" href="http://kubernetes.io/docs/user-guide/walkthrough/"&gt;walkthrough guides&lt;/a&gt; often points to the &lt;a class="reference external" href="https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook"&gt;guestbook
application&lt;/a&gt; as a quintessential example of how a simple, but complete multi-tier
web application can be deployed with Kubernetes. As described in the &lt;a class="reference external" href="https://github.com/kubernetes/kubernetes/blob/master/examples/guestbook/README.md"&gt;README&lt;/a&gt;, it
consists of a web frontend, a redis master (for storage), and a replicated set of
redis 'slaves'.&lt;/p&gt;
&lt;img alt="//cloud.google.com/container-engine/images/guestbook.png" class="align-center" src="//cloud.google.com/container-engine/images/guestbook.png"&gt;
&lt;p&gt;This seemed like an ideal starting point for deploying my &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; applications
with a similar stack, and also makes use of redis master/slaves. The difficulty
I found with readily making use of this example as a starting point is that the
frontend is implemented in PHP, which is considerably different to modern paradigms
(Node.js, Flask/Django, Rails, etc.) As described in the README:&lt;/p&gt;
&lt;blockquote&gt;
A frontend pod is a simple PHP server that is configured to talk to either
the slave or master services, depending on whether the client request is a
read or a write. It exposes a simple AJAX interface, and serves an
Angular-based UX. Again we'll create a set of replicated frontend pods
instantiated by a Deployment — this time, with three replicas.&lt;/blockquote&gt;
&lt;p&gt;I figured re-implementing the frontend pod in with Flask would require minimal
changes - the UI would remain mostly the same, and the actual interaction with
the redis master/slaves is quite trivial.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/re-implementing-the-kubernetes-guestbook-example-with-flask-and-nginx/"&gt;Read more…&lt;/a&gt; (8 min remaining to read)&lt;/p&gt;&lt;/div&gt;</description><category>angularjs</category><category>docker</category><category>flask</category><category>html</category><category>kubernetes</category><category>nginx</category><category>redis</category><category>uwsgi</category><guid>http://louistiao.me/posts/re-implementing-the-kubernetes-guestbook-example-with-flask-and-nginx/</guid><pubDate>Wed, 25 May 2016 04:10:00 GMT</pubDate></item><item><title>A Better Approach For Initializing New Nikola Themes (since v7.7.5)</title><link>http://louistiao.me/posts/a-better-approach-for-initializing-new-nikola-themes-since-v775/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;A few months ago, I wrote a post on &lt;a class="reference external" href="http://louistiao.me/posts/creating-a-nikola-theme-with-sass-compiled-bootstrap/"&gt;Creating a Nikola theme with Sass-compiled Bootstrap&lt;/a&gt;.
Since then, &lt;a class="reference external" href="https://getnikola.com/changes.html#new-in-v7-7-5"&gt;Nikola 7.7.5&lt;/a&gt; has added several new features which makes it less
tedious to get started with your custom theme.&lt;/p&gt;
&lt;div class="section" id="initializing-the-theme"&gt;
&lt;h2&gt;Initializing the Theme&lt;/h2&gt;
&lt;p&gt;First, I initialize a theme named &lt;tt class="docutils literal"&gt;tiao&lt;/tt&gt;, which automatically creates the
necessary directories and files for me.&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; nikola theme --new&lt;span class="o"&gt;=&lt;/span&gt;tiao --engine&lt;span class="o"&gt;=&lt;/span&gt;jinja --parent&lt;span class="o"&gt;=&lt;/span&gt;bootstrap3-jinja
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;[2016-05-18T02:29:49Z] INFO: theme: Creating theme tiao with parent bootstrap3-jinja and engine jinja in themes/tiao&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;[2016-05-18T02:29:49Z] INFO: theme: Created directory themes/tiao&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;[2016-05-18T02:29:49Z] INFO: theme: Created file themes/tiao/parent&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-5"&gt;&lt;/a&gt;&lt;span class="go"&gt;[2016-05-18T02:29:49Z] INFO: theme: Created file themes/tiao/engine&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;[2016-05-18T02:29:49Z] INFO: theme: Theme themes/tiao created successfully.&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;[2016-05-18T02:29:49Z] NOTICE: theme: Remember to set THEME="tiao" in conf.py to use this theme.&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-9"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; tree themes/tiao
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-10"&gt;&lt;/a&gt;&lt;span class="go"&gt;themes/tiao&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-11"&gt;&lt;/a&gt;&lt;span class="go"&gt;├── engine&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-12"&gt;&lt;/a&gt;&lt;span class="go"&gt;└── parent&lt;/span&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_946615ad401a43d8b94c30afef1a41b0-14"&gt;&lt;/a&gt;&lt;span class="go"&gt;0 directories, 2 files&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;&lt;a href="http://louistiao.me/posts/a-better-approach-for-initializing-new-nikola-themes-since-v775/"&gt;Read more…&lt;/a&gt; (1 min remaining to read)&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;</description><category>nikola</category><category>python</category><guid>http://louistiao.me/posts/a-better-approach-for-initializing-new-nikola-themes-since-v775/</guid><pubDate>Wed, 18 May 2016 02:20:24 GMT</pubDate></item><item><title>Quick Reference: Deleting Local and Remote Git Branches</title><link>http://louistiao.me/posts/quick-reference-deleting-local-and-remote-git-branches/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;From &lt;a class="reference external" href="http://stackoverflow.com/questions/2003505/delete-a-git-branch-both-locally-and-remotely"&gt;http://stackoverflow.com/questions/2003505/delete-a-git-branch-both-locally-and-remotely&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;Deleting a Local Git Branch:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_6c6b32dc39cf4be19a2e2ef99ca6350c-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; git branch -D &amp;lt;branch-name&amp;gt;
&lt;a name="rest_code_6c6b32dc39cf4be19a2e2ef99ca6350c-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;Deleted branch &amp;lt;branch-name&amp;gt; (was &amp;lt;commit-hash&amp;gt;).&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Deleting a Remote Git Branch (available as of &lt;a class="reference external" href="https://github.com/git/git/blob/c2c5f6b1e479f2c38e0e01345350620944e3527f/Documentation/RelNotes/1.7.0.txt#L154"&gt;Git 1.7.0&lt;/a&gt;)&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_c2bfa1c1e083469e8b20296aa29940ba-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; git push origin --delete &amp;lt;branch-name&amp;gt;
&lt;a name="rest_code_c2bfa1c1e083469e8b20296aa29940ba-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;To &amp;lt;git-remote-origin-url&amp;gt;&lt;/span&gt;
&lt;a name="rest_code_c2bfa1c1e083469e8b20296aa29940ba-3"&gt;&lt;/a&gt;&lt;span class="go"&gt; - [deleted]         &amp;lt;branch-name&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><category>git</category><guid>http://louistiao.me/posts/quick-reference-deleting-local-and-remote-git-branches/</guid><pubDate>Wed, 11 May 2016 07:16:05 GMT</pubDate></item><item><title>Setting up a IPython Parallel Cluster on Amazon EC2 with StarCluster</title><link>http://louistiao.me/posts/setting-up-a-ipython-parallel-cluster-on-amazon-ec2-with-starcluster/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;&lt;a class="reference external" href="http://star.mit.edu/cluster/"&gt;StarCluster&lt;/a&gt; is an open source cluster-computing toolkit for Amazon’s Elastic
Compute Cloud (EC2) that is designed to automate and simplify the process of
building, configuring, and managing clusters of virtual machines on Amazon’s
EC2 cloud. StarCluster makes it easy to create a cluster computing environment
in the cloud for distributed and parallel computing applications.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/setting-up-a-ipython-parallel-cluster-on-amazon-ec2-with-starcluster/"&gt;Read more…&lt;/a&gt; (6 min remaining to read)&lt;/p&gt;&lt;/div&gt;</description><category>amazon aws</category><category>amazon ec2</category><category>distributed computing</category><category>ipython</category><category>pip</category><category>python</category><category>starcluster</category><category>virtualenv</category><guid>http://louistiao.me/posts/setting-up-a-ipython-parallel-cluster-on-amazon-ec2-with-starcluster/</guid><pubDate>Tue, 03 May 2016 12:55:55 GMT</pubDate></item><item><title>Visualizing and Animating Optimization Algorithms with Matplotlib</title><link>http://louistiao.me/posts/notebooks/visualizing-and-animating-optimization-algorithms-with-matplotlib/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div tabindex="-1" id="notebook" class="border-box-sizing"&gt;
    &lt;div class="container" id="notebook-container"&gt;

&lt;div class="cell border-box-sizing text_cell rendered"&gt;
&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;In this series of notebooks, we demonstrate some useful patterns and recipes for visualizing animating optimization algorithms using Matplotlib.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;matplotlib&lt;/span&gt; inline
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;autograd.numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;mpl_toolkits.mplot3d&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Axes3D&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.colors&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;LogNorm&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;matplotlib&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;animation&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;IPython.display&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HTML&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;autograd&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;elementwise_grad&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value_and_grad&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scipy.optimize&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;minimize&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;collections&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;defaultdict&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;itertools&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;zip_longest&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;functools&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;partial&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;
&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;We shall restrict our attention to 3-dimensional problems for right now (i.e. optimizing over only 2 parameters), though what follows can be extended to higher dimensions by plotting all pairs of parameters against each other, effectively projecting the problem to 3-dimensions.&lt;/p&gt;
&lt;p&gt;The Wikipedia article on &lt;a href="https://en.wikipedia.org/wiki/Test_functions_for_optimization"&gt;Test functions for optimization&lt;/a&gt; has a few functions that are useful for evaluating optimization algorithms. In particular, we shall look at &lt;strong&gt;Beale's function&lt;/strong&gt;:&lt;/p&gt;
$$
f(x, y) = (1.5 - x + xy)^2 + (2.25 - x + xy^2)^2 + (2.625 - x + xy^3)^2
$$
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1.5&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.25&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.625&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;
&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/notebooks/visualizing-and-animating-optimization-algorithms-with-matplotlib/"&gt;Read more…&lt;/a&gt; (12 min remaining to read)&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description><category>autograd</category><category>ipython</category><category>jupyter</category><category>matplotlib</category><category>numpy</category><category>optimization</category><category>scipy</category><category>visualization</category><guid>http://louistiao.me/posts/notebooks/visualizing-and-animating-optimization-algorithms-with-matplotlib/</guid><pubDate>Tue, 26 Apr 2016 12:13:17 GMT</pubDate></item><item><title>Embedding Matplotlib Animations in Jupyter Notebooks</title><link>http://louistiao.me/posts/notebooks/embedding-matplotlib-animations-in-jupyter-notebooks/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div tabindex="-1" id="notebook" class="border-box-sizing"&gt;
    &lt;div class="container" id="notebook-container"&gt;

&lt;div class="cell border-box-sizing text_cell rendered"&gt;
&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;In his blog post &lt;a href="http://jakevdp.github.io/blog/2013/05/12/embedding-matplotlib-animations/"&gt;Embedding Matplotlib Animations in IPython Notebooks&lt;/a&gt;, Jake VanderPlas presents a slick hack for embedding Matplotlib Animations in IPython Notebooks, which involves writing it as a video to a &lt;a href="https://docs.python.org/2/library/tempfile.html"&gt;tempfile&lt;/a&gt;, and then re-encoding it in Base64 as a HTML5 Video.&lt;/p&gt;
&lt;p&gt;Unfortunately (or rather fortunately), this hack has been largely rendered obsolete by the heavy development efforts dedicated to both Matplotlib and IPython Notebook (&lt;a href="https://blog.jupyter.org/2015/08/12/first-release-of-jupyter/"&gt;since renamed to Jupyter Notebook&lt;/a&gt;) in recent years. In particular, &lt;a href="http://matplotlib.org/users/whats_new.html#new-in-matplotlib-1-5"&gt;Matplotlib 1.5.1&lt;/a&gt; now &lt;a href="http://matplotlib.org/users/whats_new.html#display-hook-for-animations-in-the-ipython-notebook"&gt;supports inline display of animations in the notebook&lt;/a&gt; with the &lt;code&gt;to_html5_video&lt;/code&gt; method, which converts the animation to an h264 encoded video and embeddeds it directly in the notebook.&lt;/p&gt;
&lt;p&gt;In this notebook, we reproduce Jake VanderPlas' blog post with this new feature.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/notebooks/embedding-matplotlib-animations-in-jupyter-notebooks/"&gt;Read more…&lt;/a&gt; (2 min remaining to read)&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description><guid>http://louistiao.me/posts/notebooks/embedding-matplotlib-animations-in-jupyter-notebooks/</guid><pubDate>Sat, 16 Apr 2016 11:10:04 GMT</pubDate></item><item><title>Installing Cartopy on Mac OSX (10.11)</title><link>http://louistiao.me/posts/installing-cartopy-on-mac-osx-1011/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;So you develop on Mac OS X (10.11) and have installed the external
dependencies (&lt;a class="reference external" href="https://trac.osgeo.org/geos/"&gt;geos&lt;/a&gt; 3.5.0, &lt;a class="reference external" href="https://trac.osgeo.org/proj/"&gt;proj&lt;/a&gt; 4.9.2) of &lt;a class="reference external" href="http://scitools.org.uk/cartopy/"&gt;Cartopy&lt;/a&gt; with &lt;a class="reference external" href="http://brew.sh/"&gt;Homebrew&lt;/a&gt;:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_77cee92c35a049ccaecd30b5f29dedaa-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; brew install geos
&lt;a name="rest_code_77cee92c35a049ccaecd30b5f29dedaa-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; brew install proj
&lt;/pre&gt;&lt;p&gt;Moreover, you have created a &lt;tt class="docutils literal"&gt;virtualenv&lt;/tt&gt; and installed the Python
dependencies (Cython, NumPy):&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_8dcf7809e38b409a80e80979a670406b-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkvirtualenv cartopy_venv
&lt;a name="rest_code_8dcf7809e38b409a80e80979a670406b-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;(cartopy_venv)$&lt;/span&gt; pip install cython
&lt;a name="rest_code_8dcf7809e38b409a80e80979a670406b-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;(cartopy_venv)$&lt;/span&gt; pip install numpy
&lt;/pre&gt;&lt;p&gt;Yet, when you finally go install Cartopy, you still encounter the following
seemingly inexplicable error:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;(cartopy_venv)$&lt;/span&gt; pip install cartopy
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;[...]&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;clang -fno-strict-aliasing -fno-common -dynamic -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/usr/local/Cellar/python/2.7.11/Frameworks/Python.framework/Versions/2.7/include -I./lib/cartopy -I-I/usr/local/Cellar/proj/4.9.2/include -I/usr/local/Cellar/geos/3.5.0/include -I/usr/local/Cellar/python/2.7.11/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c lib/cartopy/trace.cpp -o build/temp.macosx-10.11-x86_64-2.7/lib/cartopy/trace.o&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;lib/cartopy/trace.cpp:249:10: fatal error: 'proj_api.h' file not found&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;#&lt;/span&gt;include &lt;span class="s2"&gt;"proj_api.h"&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;         ^&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;1 error generated.&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-8"&gt;&lt;/a&gt;&lt;span class="go"&gt;error: command 'clang' failed with exit status 1&lt;/span&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_1fb99b8052924ed09cd17c002f446261-10"&gt;&lt;/a&gt;&lt;span class="go"&gt;----------------------------------------&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;&lt;a href="http://louistiao.me/posts/installing-cartopy-on-mac-osx-1011/"&gt;Read more…&lt;/a&gt; (1 min remaining to read)&lt;/p&gt;&lt;/div&gt;</description><category>cartopy</category><category>cython</category><category>geos</category><category>numpy</category><category>proj.4</category><guid>http://louistiao.me/posts/installing-cartopy-on-mac-osx-1011/</guid><pubDate>Thu, 31 Mar 2016 12:33:50 GMT</pubDate></item><item><title>Workflow for keeping Nikola config file updated</title><link>http://louistiao.me/posts/workflow-for-keeping-nikola-config-file-updated/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;For most, keeping Nikola up-to-date is usually a simple matter of running
something like:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_e89dac43aa4a47f79ca52c2c4838f965-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; pip install --upgrade nikola
&lt;/pre&gt;&lt;p&gt;The same goes for its dependencies. However, one important thing that can get
overlooked is the Nikola configuration file for your site (the &lt;tt class="docutils literal"&gt;conf.py&lt;/tt&gt; file
sitting at the root of your Nikola site directory), which is almost always
updated with each major Nikola release.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/workflow-for-keeping-nikola-config-file-updated/"&gt;Read more…&lt;/a&gt; (1 min remaining to read)&lt;/p&gt;&lt;/div&gt;</description><category>meld</category><category>nikola</category><category>pip</category><category>python</category><guid>http://louistiao.me/posts/workflow-for-keeping-nikola-config-file-updated/</guid><pubDate>Tue, 29 Mar 2016 00:13:12 GMT</pubDate></item><item><title>Creating custom (Unix) fortunes</title><link>http://louistiao.me/posts/creating-custom-unix-fortunes/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;Like others, I include &lt;tt class="docutils literal"&gt;fortune&lt;/tt&gt; in my &lt;tt class="docutils literal"&gt;.bash_profile&lt;/tt&gt; so that I am
greeted with a random, witty and thought-provoking epigram upon starting a
new shell session. Eventually, however, I found most of the epigrams to be
mostly trite and vapid, and quickly grew tired of them. Instead of tinkering
with the probabilities of sampling from the various datafiles available, I
decided to roll with my own epigram datafile.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/creating-custom-unix-fortunes/"&gt;Read more…&lt;/a&gt; (3 min remaining to read)&lt;/p&gt;&lt;/div&gt;</description><category>bash</category><category>cowsay</category><category>fortune</category><category>gtd</category><category>lolcat</category><category>unix</category><guid>http://louistiao.me/posts/creating-custom-unix-fortunes/</guid><pubDate>Wed, 17 Feb 2016 14:15:42 GMT</pubDate></item></channel></rss>