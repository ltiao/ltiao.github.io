<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="variational_autoencoder.ipynb">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>variational_autoencoder.ipynb | Louis Tiao</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/override_nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://louistiao.me/listings/vae/variational_autoencoder.ipynb.html">
<link rel="icon" href="../../favicon_16x16.ico" sizes="16x16">
<link rel="icon" href="../../favicon_32x32.ico" sizes="32x32">
<link rel="icon" href="../../favicon_256x256.ico" sizes="256x256">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!--

    /\\\\\\\\\\\\\\\  /\\\\\\\\\\\     /\\\\\\\\\          /\\\\\              
    \///////\\\/////  \/////\\\///    /\\\\\\\\\\\\\      /\\\///\\\           
           \/\\\           \/\\\      /\\\/////////\\\   /\\\/  \///\\\        
            \/\\\           \/\\\     \/\\\       \/\\\  /\\\      \//\\\      
             \/\\\           \/\\\     \/\\\\\\\\\\\\\\\ \/\\\       \/\\\     
              \/\\\           \/\\\     \/\\\/////////\\\ \//\\\      /\\\     
               \/\\\           \/\\\     \/\\\       \/\\\  \///\\\  /\\\      
                \/\\\        /\\\\\\\\\\\ \/\\\       \/\\\    \///\\\\\/      
                 \///        \///////////  \///        \///       \/////       

-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

  <div class="container">
    <div class="header clearfix">
      <nav><ul class="nav nav-pills pull-right">
<li>
<a href="../../">About</a>
                </li>
<li>
<a href="../../projects/">Projects</a>
                </li>
<li>
<a href="../../posts/">Posts</a>
                </li>
<li>
<a href="../../archive.html">Archive</a>

          
        </li>
</ul></nav><a href="http://louistiao.me/">

        <h3 class="text-muted">
          <span id="blog-title">Louis Tiao</span>
        </h3>
      </a>
    </div>

<!-- TODO Figure out what to do with this stuff -->
<!--     <div class="row">

      <ul class="nav nav-pills pull-right">
    <li>
    <a href="/listings/vae/variational_autoencoder.ipynb" id="sourcelink">Source</a>
    </li>
          
      </ul>
    </div> -->

    <div id="content" role="main">
      <div class="body-content">
        <!--Body content-->
        <div class="row">
          
<nav class="breadcrumbs"><ul class="breadcrumb">
<li><a href="../">listings</a></li>
                <li><a href=".">vae</a></li>
                <li>variational_autoencoder.ipynb</li>
</ul></nav><h1>variational_autoencoder.ipynb
        <small><a href="variational_autoencoder.ipynb">(Source)</a></small>
    </h1>
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Preamble">Preamble<a class="anchor-link" href="#Preamble">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> notebook
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">norm</span>

<span class="kn">from</span> <span class="nn">keras</span> <span class="k">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>

<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="k">import</span> <span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">InputLayer</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">,</span> <span class="n">Layer</span><span class="p">,</span> 
                          <span class="n">Add</span><span class="p">,</span> <span class="n">Multiply</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="k">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.datasets</span> <span class="k">import</span> <span class="n">mnist</span>


<span class="kn">from</span> <span class="nn">keras.utils.vis_utils</span> <span class="k">import</span> <span class="n">model_to_dot</span><span class="p">,</span> <span class="n">plot_model</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">SVG</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Notebook-Configuration">Notebook Configuration<a class="anchor-link" href="#Notebook-Configuration">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">edgeitems</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
                    <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s1">'TensorFlow version: '</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'TensorFlow version: 1.4.0'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Constant-definitions">Constant definitions<a class="anchor-link" href="#Constant-definitions">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">original_dim</span> <span class="o">=</span> <span class="mi">784</span>
<span class="n">latent_dim</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">intermediate_dim</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">epsilon_std</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Variational-Autoencoder">Variational Autoencoder<a class="anchor-link" href="#Variational-Autoencoder">¶</a>
</h2>
<h3 id="Model-definition">Model definition<a class="anchor-link" href="#Model-definition">¶</a>
</h3>
<h4 id="Encoder">Encoder<a class="anchor-link" href="#Encoder">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Figure-1:-Reparameterization-using-Keras-Layers">Figure 1: Reparameterization using Keras Layers<a class="anchor-link" href="#Figure-1:-Reparameterization-using-Keras-Layers">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">z_mu</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'mu'</span><span class="p">)</span>
<span class="n">z_sigma</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'sigma'</span><span class="p">)</span>
<span class="n">eps</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'eps'</span><span class="p">)</span>
<span class="n">z_eps</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'z_eps'</span><span class="p">)([</span><span class="n">z_sigma</span><span class="p">,</span> <span class="n">eps</span><span class="p">])</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'z'</span><span class="p">)([</span><span class="n">z_mu</span><span class="p">,</span> <span class="n">z_eps</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">eps</span><span class="p">,</span> <span class="n">z_mu</span><span class="p">,</span> <span class="n">z_sigma</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SVG</span><span class="p">(</span><span class="n">model_to_dot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'svg'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg height="191pt" viewbox="0.00 0.00 370.50 191.00" width="371pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 187)"><title>G</title>
<polygon fill="#ffffff" points="-4,4 -4,-187 366.5,-187 366.5,4 -4,4" stroke="transparent"></polygon><!-- 140175856602192 --><g class="node" id="node1"><title>140175856602192</title>
<polygon fill="none" points="0,-146.5 0,-182.5 149,-182.5 149,-146.5 0,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="74.5" y="-160.8">sigma: InputLayer</text></g><!-- 140175856602360 --><g class="node" id="node4"><title>140175856602360</title>
<polygon fill="none" points="91,-73.5 91,-109.5 216,-109.5 216,-73.5 91,-73.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="153.5" y="-87.8">z_eps: Multiply</text></g><!-- 140175856602192&#45;&gt;140175856602360 --><g class="edge" id="edge1"><title>140175856602192-&gt;140175856602360</title>
<path d="M94.0281,-146.4551C103.8083,-137.4177 115.8052,-126.3319 126.4561,-116.4899" fill="none" stroke="#000000"></path><polygon fill="#000000" points="128.9536,-118.9476 133.9228,-109.5904 124.2029,-113.8065 128.9536,-118.9476" stroke="#000000"></polygon></g><!-- 140175856601800 --><g class="node" id="node2"><title>140175856601800</title>
<polygon fill="none" points="167,-146.5 167,-182.5 298,-182.5 298,-146.5 167,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="232.5" y="-160.8">eps: InputLayer</text></g><!-- 140175856601800&#45;&gt;140175856602360 --><g class="edge" id="edge2"><title>140175856601800-&gt;140175856602360</title>
<path d="M212.9719,-146.4551C203.1917,-137.4177 191.1948,-126.3319 180.5439,-116.4899" fill="none" stroke="#000000"></path><polygon fill="#000000" points="182.7971,-113.8065 173.0772,-109.5904 178.0464,-118.9476 182.7971,-113.8065" stroke="#000000"></polygon></g><!-- 140175856602248 --><g class="node" id="node3"><title>140175856602248</title>
<polygon fill="none" points="234.5,-73.5 234.5,-109.5 362.5,-109.5 362.5,-73.5 234.5,-73.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="298.5" y="-87.8">mu: InputLayer</text></g><!-- 140175856600736 --><g class="node" id="node5"><title>140175856600736</title>
<polygon fill="none" points="194.5,-.5 194.5,-36.5 256.5,-36.5 256.5,-.5 194.5,-.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="225.5" y="-14.8">z: Add</text></g><!-- 140175856602248&#45;&gt;140175856600736 --><g class="edge" id="edge3"><title>140175856602248-&gt;140175856600736</title>
<path d="M280.4551,-73.4551C271.5054,-64.5054 260.547,-53.547 250.7769,-43.7769" fill="none" stroke="#000000"></path><polygon fill="#000000" points="253.1363,-41.1866 243.5904,-36.5904 248.1866,-46.1363 253.1363,-41.1866" stroke="#000000"></polygon></g><!-- 140175856602360&#45;&gt;140175856600736 --><g class="edge" id="edge4"><title>140175856602360-&gt;140175856600736</title>
<path d="M171.2978,-73.4551C180.1248,-64.5054 190.9331,-53.547 200.5693,-43.7769" fill="none" stroke="#000000"></path><polygon fill="#000000" points="203.1272,-46.1678 207.6575,-36.5904 198.1434,-41.2523 203.1272,-46.1678" stroke="#000000"></polygon></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/reparameterization.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/reparameterization.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Figure-2:-Encoder-architecture">Figure 2: Encoder architecture<a class="anchor-link" href="#Figure-2:-Encoder-architecture">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">original_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'x'</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">intermediate_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'encoder_hidden'</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">z_mu</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'mu'</span><span class="p">)(</span><span class="n">h</span><span class="p">)</span>
<span class="n">z_log_var</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'log_var'</span><span class="p">)(</span><span class="n">h</span><span class="p">)</span>
<span class="n">z_sigma</span> <span class="o">=</span> <span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">K</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'sigma'</span><span class="p">)(</span><span class="n">z_log_var</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eps</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'eps'</span><span class="p">)</span>
<span class="n">z_eps</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'z_eps'</span><span class="p">)([</span><span class="n">z_sigma</span><span class="p">,</span> <span class="n">eps</span><span class="p">])</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'z'</span><span class="p">)([</span><span class="n">z_mu</span><span class="p">,</span> <span class="n">z_eps</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">eps</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SVG</span><span class="p">(</span><span class="n">model_to_dot</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'svg'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[29]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg height="410pt" viewbox="0.00 0.00 358.00 410.00" width="358pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 406)"><title>G</title>
<polygon fill="#ffffff" points="-4,4 -4,-406 354,-406 354,4 -4,4" stroke="transparent"></polygon><!-- 140175855034552 --><g class="node" id="node1"><title>140175855034552</title>
<polygon fill="none" points="126,-365.5 126,-401.5 240,-401.5 240,-365.5 126,-365.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="183" y="-379.8">x: InputLayer</text></g><!-- 140175854580456 --><g class="node" id="node2"><title>140175854580456</title>
<polygon fill="none" points="91,-292.5 91,-328.5 275,-328.5 275,-292.5 91,-292.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="183" y="-306.8">encoder_hidden: Dense</text></g><!-- 140175855034552&#45;&gt;140175854580456 --><g class="edge" id="edge1"><title>140175855034552-&gt;140175854580456</title>
<path d="M183,-365.4551C183,-357.3828 183,-347.6764 183,-338.6817" fill="none" stroke="#000000"></path><polygon fill="#000000" points="186.5001,-338.5903 183,-328.5904 179.5001,-338.5904 186.5001,-338.5903" stroke="#000000"></polygon></g><!-- 140175854581184 --><g class="node" id="node3"><title>140175854581184</title>
<polygon fill="none" points="78,-219.5 78,-255.5 200,-255.5 200,-219.5 78,-219.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="139" y="-233.8">log_var: Dense</text></g><!-- 140175854580456&#45;&gt;140175854581184 --><g class="edge" id="edge2"><title>140175854580456-&gt;140175854581184</title>
<path d="M172.1236,-292.4551C166.9937,-283.9441 160.7688,-273.6165 155.1064,-264.2219" fill="none" stroke="#000000"></path><polygon fill="#000000" points="158.0636,-262.3481 149.9038,-255.5904 152.0684,-265.9617 158.0636,-262.3481" stroke="#000000"></polygon></g><!-- 140175854580512 --><g class="node" id="node6"><title>140175854580512</title>
<polygon fill="none" points="258,-73.5 258,-109.5 350,-109.5 350,-73.5 258,-73.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="304" y="-87.8">mu: Dense</text></g><!-- 140175854580456&#45;&gt;140175854580512 --><g class="edge" id="edge4"><title>140175854580456-&gt;140175854580512</title>
<path d="M202.4427,-292.1722C225.7862,-269.0153 264.3645,-226.862 285,-183 294.397,-163.0262 299.1723,-138.4386 301.5842,-119.783" fill="none" stroke="#000000"></path><polygon fill="#000000" points="305.0634,-120.1634 302.7218,-109.8305 298.1087,-119.3683 305.0634,-120.1634" stroke="#000000"></polygon></g><!-- 140175854597680 --><g class="node" id="node4"><title>140175854597680</title>
<polygon fill="none" points="0,-146.5 0,-182.5 126,-182.5 126,-146.5 0,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="63" y="-160.8">sigma: Lambda</text></g><!-- 140175854581184&#45;&gt;140175854597680 --><g class="edge" id="edge3"><title>140175854581184-&gt;140175854597680</title>
<path d="M120.2135,-219.4551C110.8961,-210.5054 99.4873,-199.547 89.3157,-189.7769" fill="none" stroke="#000000"></path><polygon fill="#000000" points="91.4704,-186.9935 81.8338,-182.5904 86.6212,-192.0419 91.4704,-186.9935" stroke="#000000"></polygon></g><!-- 140175854672976 --><g class="node" id="node7"><title>140175854672976</title>
<polygon fill="none" points="114.5,-73.5 114.5,-109.5 239.5,-109.5 239.5,-73.5 114.5,-73.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="177" y="-87.8">z_eps: Multiply</text></g><!-- 140175854597680&#45;&gt;140175854672976 --><g class="edge" id="edge5"><title>140175854597680-&gt;140175854672976</title>
<path d="M91.1798,-146.4551C105.978,-136.979 124.2933,-125.2508 140.1986,-115.0658" fill="none" stroke="#000000"></path><polygon fill="#000000" points="142.2154,-117.9305 148.7493,-109.5904 138.4405,-112.0356 142.2154,-117.9305" stroke="#000000"></polygon></g><!-- 140175855075168 --><g class="node" id="node5"><title>140175855075168</title>
<polygon fill="none" points="144.5,-146.5 144.5,-182.5 275.5,-182.5 275.5,-146.5 144.5,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="210" y="-160.8">eps: InputLayer</text></g><!-- 140175855075168&#45;&gt;140175854672976 --><g class="edge" id="edge6"><title>140175855075168-&gt;140175854672976</title>
<path d="M201.8427,-146.4551C198.0746,-138.1196 193.5188,-128.0416 189.343,-118.8042" fill="none" stroke="#000000"></path><polygon fill="#000000" points="192.4864,-117.2608 185.1778,-109.5904 186.1078,-120.1443 192.4864,-117.2608" stroke="#000000"></polygon></g><!-- 140175854673536 --><g class="node" id="node8"><title>140175854673536</title>
<polygon fill="none" points="209,-.5 209,-36.5 271,-36.5 271,-.5 209,-.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="240" y="-14.8">z: Add</text></g><!-- 140175854580512&#45;&gt;140175854673536 --><g class="edge" id="edge7"><title>140175854580512-&gt;140175854673536</title>
<path d="M288.1798,-73.4551C280.4874,-64.6809 271.1022,-53.9759 262.6656,-44.353" fill="none" stroke="#000000"></path><polygon fill="#000000" points="265.0842,-41.8024 255.86,-36.5904 259.8206,-46.4171 265.0842,-41.8024" stroke="#000000"></polygon></g><!-- 140175854672976&#45;&gt;140175854673536 --><g class="edge" id="edge8"><title>140175854672976-&gt;140175854673536</title>
<path d="M192.573,-73.4551C200.1452,-64.6809 209.3838,-53.9759 217.6885,-44.353" fill="none" stroke="#000000"></path><polygon fill="#000000" points="220.5039,-46.4477 224.3878,-36.5904 215.2045,-41.8742 220.5039,-46.4477" stroke="#000000"></polygon></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/encoder.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/encoder_shapes.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Figure-3:-Full-Encoder-architecture-with-auxiliary-layers">Figure 3: Full Encoder architecture with auxiliary layers<a class="anchor-link" href="#Figure-3:-Full-Encoder-architecture-with-auxiliary-layers">¶</a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">KLDivergenceLayer</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_placeholder</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">KLDivergenceLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>

        <span class="n">mu</span><span class="p">,</span> <span class="n">log_var</span> <span class="o">=</span> <span class="n">inputs</span>

        <span class="n">kl</span> <span class="o">=</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">print_tensor</span><span class="p">(</span><span class="n">log_var</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">'prick'</span><span class="p">)</span> 
                            <span class="o">-</span> <span class="n">K</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> 
                            <span class="o">-</span> <span class="n">K</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_var</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_loss</span><span class="p">(</span><span class="n">kl</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">z_mu</span><span class="p">,</span> <span class="n">z_log_var</span> <span class="o">=</span> <span class="n">KLDivergenceLayer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'kl'</span><span class="p">)([</span><span class="n">z_mu</span><span class="p">,</span> <span class="n">z_log_var</span><span class="p">])</span>
<span class="n">z_sigma</span> <span class="o">=</span> <span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">K</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'sigma'</span><span class="p">)(</span><span class="n">z_log_var</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eps</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'eps'</span><span class="p">)</span>
<span class="n">z_eps</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'sigma_eps'</span><span class="p">)([</span><span class="n">z_sigma</span><span class="p">,</span> <span class="n">eps</span><span class="p">])</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'z'</span><span class="p">)([</span><span class="n">z_mu</span><span class="p">,</span> <span class="n">z_eps</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">eps</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SVG</span><span class="p">(</span><span class="n">model_to_dot</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'svg'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[36]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg height="483pt" viewbox="0.00 0.00 315.00 483.00" width="315pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 479)"><title>G</title>
<polygon fill="#ffffff" points="-4,4 -4,-479 311,-479 311,4 -4,4" stroke="transparent"></polygon><!-- 140175855034552 --><g class="node" id="node1"><title>140175855034552</title>
<polygon fill="none" points="126,-438.5 126,-474.5 240,-474.5 240,-438.5 126,-438.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="183" y="-452.8">x: InputLayer</text></g><!-- 140175854580456 --><g class="node" id="node2"><title>140175854580456</title>
<polygon fill="none" points="91,-365.5 91,-401.5 275,-401.5 275,-365.5 91,-365.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="183" y="-379.8">encoder_hidden: Dense</text></g><!-- 140175855034552&#45;&gt;140175854580456 --><g class="edge" id="edge1"><title>140175855034552-&gt;140175854580456</title>
<path d="M183,-438.4551C183,-430.3828 183,-420.6764 183,-411.6817" fill="none" stroke="#000000"></path><polygon fill="#000000" points="186.5001,-411.5903 183,-401.5904 179.5001,-411.5904 186.5001,-411.5903" stroke="#000000"></polygon></g><!-- 140175854580512 --><g class="node" id="node3"><title>140175854580512</title>
<polygon fill="none" points="75,-292.5 75,-328.5 167,-328.5 167,-292.5 75,-292.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="121" y="-306.8">mu: Dense</text></g><!-- 140175854580456&#45;&gt;140175854580512 --><g class="edge" id="edge2"><title>140175854580456-&gt;140175854580512</title>
<path d="M167.6742,-365.4551C160.2221,-356.6809 151.1302,-345.9759 142.9573,-336.353" fill="none" stroke="#000000"></path><polygon fill="#000000" points="145.5056,-333.9466 136.3644,-328.5904 140.1702,-338.4781 145.5056,-333.9466" stroke="#000000"></polygon></g><!-- 140175854581184 --><g class="node" id="node4"><title>140175854581184</title>
<polygon fill="none" points="185,-292.5 185,-328.5 307,-328.5 307,-292.5 185,-292.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="246" y="-306.8">log_var: Dense</text></g><!-- 140175854580456&#45;&gt;140175854581184 --><g class="edge" id="edge3"><title>140175854580456-&gt;140175854581184</title>
<path d="M198.573,-365.4551C206.1452,-356.6809 215.3838,-345.9759 223.6885,-336.353" fill="none" stroke="#000000"></path><polygon fill="#000000" points="226.5039,-338.4477 230.3878,-328.5904 221.2045,-333.8742 226.5039,-338.4477" stroke="#000000"></polygon></g><!-- 140175854990168 --><g class="node" id="node5"><title>140175854990168</title>
<polygon fill="none" points="92,-219.5 92,-255.5 274,-255.5 274,-219.5 92,-219.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="183" y="-233.8">kl: KLDivergenceLayer</text></g><!-- 140175854580512&#45;&gt;140175854990168 --><g class="edge" id="edge4"><title>140175854580512-&gt;140175854990168</title>
<path d="M136.3258,-292.4551C143.7779,-283.6809 152.8698,-272.9759 161.0427,-263.353" fill="none" stroke="#000000"></path><polygon fill="#000000" points="163.8298,-265.4781 167.6356,-255.5904 158.4944,-260.9466 163.8298,-265.4781" stroke="#000000"></polygon></g><!-- 140175854581184&#45;&gt;140175854990168 --><g class="edge" id="edge5"><title>140175854581184-&gt;140175854990168</title>
<path d="M230.427,-292.4551C222.8548,-283.6809 213.6162,-272.9759 205.3115,-263.353" fill="none" stroke="#000000"></path><polygon fill="#000000" points="207.7955,-260.8742 198.6122,-255.5904 202.4961,-265.4477 207.7955,-260.8742" stroke="#000000"></polygon></g><!-- 140176957339800 --><g class="node" id="node6"><title>140176957339800</title>
<polygon fill="none" points="0,-146.5 0,-182.5 126,-182.5 126,-146.5 0,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="63" y="-160.8">sigma: Lambda</text></g><!-- 140175854990168&#45;&gt;140176957339800 --><g class="edge" id="edge6"><title>140175854990168-&gt;140176957339800</title>
<path d="M153.3371,-219.4551C137.76,-209.979 118.4807,-198.2508 101.7383,-188.0658" fill="none" stroke="#000000"></path><polygon fill="#000000" points="103.1,-184.7974 92.7376,-182.5904 99.4619,-190.7778 103.1,-184.7974" stroke="#000000"></polygon></g><!-- 140175854993136 --><g class="node" id="node9"><title>140175854993136</title>
<polygon fill="none" points="218,-.5 218,-36.5 280,-36.5 280,-.5 218,-.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="249" y="-14.8">z: Add</text></g><!-- 140175854990168&#45;&gt;140175854993136 --><g class="edge" id="edge9"><title>140175854990168-&gt;140175854993136</title>
<path d="M240.5572,-219.4931C257.5454,-211.1963 274.1989,-199.4258 284,-183 309.051,-141.017 297.766,-119.9108 284,-73 281.133,-63.23 275.9155,-53.5532 270.3689,-45.1259" fill="none" stroke="#000000"></path><polygon fill="#000000" points="273.1652,-43.0175 264.5544,-36.8446 267.4363,-47.0399 273.1652,-43.0175" stroke="#000000"></polygon></g><!-- 140175854990000 --><g class="node" id="node8"><title>140175854990000</title>
<polygon fill="none" points="114.5,-73.5 114.5,-109.5 275.5,-109.5 275.5,-73.5 114.5,-73.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="195" y="-87.8">sigma_eps: Multiply</text></g><!-- 140176957339800&#45;&gt;140175854990000 --><g class="edge" id="edge7"><title>140176957339800-&gt;140175854990000</title>
<path d="M95.6292,-146.4551C113.0814,-136.8035 134.758,-124.8156 153.4081,-114.5016" fill="none" stroke="#000000"></path><polygon fill="#000000" points="155.2316,-117.4928 162.2887,-109.5904 151.8439,-111.3671 155.2316,-117.4928" stroke="#000000"></polygon></g><!-- 140175854990224 --><g class="node" id="node7"><title>140175854990224</title>
<polygon fill="none" points="144.5,-146.5 144.5,-182.5 275.5,-182.5 275.5,-146.5 144.5,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="210" y="-160.8">eps: InputLayer</text></g><!-- 140175854990224&#45;&gt;140175854990000 --><g class="edge" id="edge8"><title>140175854990224-&gt;140175854990000</title>
<path d="M206.2921,-146.4551C204.6154,-138.2951 202.5956,-128.4652 200.7306,-119.3887" fill="none" stroke="#000000"></path><polygon fill="#000000" points="204.1584,-118.6812 198.7172,-109.5904 197.3016,-120.0902 204.1584,-118.6812" stroke="#000000"></polygon></g><!-- 140175854990000&#45;&gt;140175854993136 --><g class="edge" id="edge10"><title>140175854990000-&gt;140175854993136</title>
<path d="M208.3483,-73.4551C214.7739,-64.7686 222.5993,-54.1898 229.6621,-44.642" fill="none" stroke="#000000"></path><polygon fill="#000000" points="232.4849,-46.7113 235.6181,-36.5904 226.8572,-42.5484 232.4849,-46.7113" stroke="#000000"></polygon></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/encoder_full.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/encoder_full_shapes.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Decoder">Decoder<a class="anchor-link" href="#Decoder">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decoder</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
    <span class="n">Dense</span><span class="p">(</span><span class="n">intermediate_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">,</span> 
          <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'decoder_hidden'</span><span class="p">),</span>
    <span class="n">Dense</span><span class="p">(</span><span class="n">original_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'sigmoid'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'x_mean'</span><span class="p">)</span>
<span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'decoder'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># equivalent to above. Writing InputLayer </span>
<span class="c1"># explicitly for layer name in diagram </span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
    <span class="n">InputLayer</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'z'</span><span class="p">),</span>
    <span class="n">Dense</span><span class="p">(</span><span class="n">intermediate_dim</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">latent_dim</span><span class="p">,),</span>
          <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'decoder_hidden'</span><span class="p">),</span>
    <span class="n">Dense</span><span class="p">(</span><span class="n">original_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'sigmoid'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'x_mean'</span><span class="p">)</span>
<span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'decoder'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SVG</span><span class="p">(</span><span class="n">model_to_dot</span><span class="p">(</span><span class="n">decoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'svg'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[61]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg height="191pt" viewbox="0.00 0.00 192.00 191.00" width="192pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 187)"><title>G</title>
<polygon fill="#ffffff" points="-4,4 -4,-187 188,-187 188,4 -4,4" stroke="transparent"></polygon><!-- 140175839431480 --><g class="node" id="node1"><title>140175839431480</title>
<polygon fill="none" points="35.5,-146.5 35.5,-182.5 148.5,-182.5 148.5,-146.5 35.5,-146.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="92" y="-160.8">z: InputLayer</text></g><!-- 140175839430864 --><g class="node" id="node2"><title>140175839430864</title>
<polygon fill="none" points="0,-73.5 0,-109.5 184,-109.5 184,-73.5 0,-73.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="92" y="-87.8">decoder_hidden: Dense</text></g><!-- 140175839431480&#45;&gt;140175839430864 --><g class="edge" id="edge1"><title>140175839431480-&gt;140175839430864</title>
<path d="M92,-146.4551C92,-138.3828 92,-128.6764 92,-119.6817" fill="none" stroke="#000000"></path><polygon fill="#000000" points="95.5001,-119.5903 92,-109.5904 88.5001,-119.5904 95.5001,-119.5903" stroke="#000000"></polygon></g><!-- 140175839430920 --><g class="node" id="node3"><title>140175839430920</title>
<polygon fill="none" points="29.5,-.5 29.5,-36.5 154.5,-36.5 154.5,-.5 29.5,-.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="92" y="-14.8">x_mean: Dense</text></g><!-- 140175839430864&#45;&gt;140175839430920 --><g class="edge" id="edge2"><title>140175839430864-&gt;140175839430920</title>
<path d="M92,-73.4551C92,-65.3828 92,-55.6764 92,-46.6817" fill="none" stroke="#000000"></path><polygon fill="#000000" points="95.5001,-46.5903 92,-36.5904 88.5001,-46.5904 95.5001,-46.5903" stroke="#000000"></polygon></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">decoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/decoder.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">decoder</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/decoder_shapes.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_decoded</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># again, equivalent to above. writing out fully</span>
<span class="c1"># for final end-to-end vae architecture visualization;</span>
<span class="c1"># otherwise, sequential models just get chunked into</span>
<span class="c1"># single layer</span>
<span class="n">h_decoded</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">intermediate_dim</span><span class="p">,</span> 
                  <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">,</span> 
                  <span class="n">name</span><span class="o">=</span><span class="s1">'decoder_hidden'</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
<span class="n">x_decoded</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">original_dim</span><span class="p">,</span> 
                  <span class="n">activation</span><span class="o">=</span><span class="s1">'sigmoid'</span><span class="p">,</span> 
                  <span class="n">name</span><span class="o">=</span><span class="s1">'x_mean'</span><span class="p">)(</span><span class="n">h_decoded</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [66]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">nll</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="sd">""" Negative log likelihood. """</span>

    <span class="c1"># keras.losses.binary_crossentropy give the mean</span>
    <span class="c1"># over the last axis. we require the sum</span>
    <span class="k">return</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">binary_crossentropy</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vae</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">eps</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">x_decoded</span><span class="p">)</span>
<span class="n">vae</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">'rmsprop'</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">nll</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [68]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SVG</span><span class="p">(</span><span class="n">model_to_dot</span><span class="p">(</span><span class="n">vae</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'svg'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[68]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg height="719pt" viewbox="0.00 0.00 676.00 719.00" width="676pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 715)"><title>G</title>
<polygon fill="#ffffff" points="-4,4 -4,-715 672,-715 672,4 -4,4" stroke="transparent"></polygon><!-- 140175855034552 --><g class="node" id="node1"><title>140175855034552</title>
<polygon fill="none" points="230,-664.5 230,-710.5 513,-710.5 513,-664.5 230,-664.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="287" y="-683.8">x: InputLayer</text><polyline fill="none" points="344,-664.5 344,-710.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="378" y="-695.3">input:</text><polyline fill="none" points="344,-687.5 412,-687.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="378" y="-672.3">output:</text><polyline fill="none" points="412,-664.5 412,-710.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="462.5" y="-695.3">(None, 784)</text><polyline fill="none" points="412,-687.5 513,-687.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="462.5" y="-672.3">(None, 784)</text></g><!-- 140175854580456 --><g class="node" id="node2"><title>140175854580456</title>
<polygon fill="none" points="195,-581.5 195,-627.5 548,-627.5 548,-581.5 195,-581.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="287" y="-600.8">encoder_hidden: Dense</text><polyline fill="none" points="379,-581.5 379,-627.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="413" y="-612.3">input:</text><polyline fill="none" points="379,-604.5 447,-604.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="413" y="-589.3">output:</text><polyline fill="none" points="447,-581.5 447,-627.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="497.5" y="-612.3">(None, 784)</text><polyline fill="none" points="447,-604.5 548,-604.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="497.5" y="-589.3">(None, 256)</text></g><!-- 140175855034552&#45;&gt;140175854580456 --><g class="edge" id="edge1"><title>140175855034552-&gt;140175854580456</title>
<path d="M371.5,-664.3799C371.5,-656.1745 371.5,-646.7679 371.5,-637.8786" fill="none" stroke="#000000"></path><polygon fill="#000000" points="375.0001,-637.784 371.5,-627.784 368.0001,-637.784 375.0001,-637.784" stroke="#000000"></polygon></g><!-- 140175854580512 --><g class="node" id="node3"><title>140175854580512</title>
<polygon fill="none" points="94,-498.5 94,-544.5 355,-544.5 355,-498.5 94,-498.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="140" y="-517.8">mu: Dense</text><polyline fill="none" points="186,-498.5 186,-544.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="220" y="-529.3">input:</text><polyline fill="none" points="186,-521.5 254,-521.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="220" y="-506.3">output:</text><polyline fill="none" points="254,-498.5 254,-544.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="304.5" y="-529.3">(None, 256)</text><polyline fill="none" points="254,-521.5 355,-521.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="304.5" y="-506.3">(None, 2)</text></g><!-- 140175854580456&#45;&gt;140175854580512 --><g class="edge" id="edge2"><title>140175854580456-&gt;140175854580512</title>
<path d="M330.5523,-581.3799C313.1037,-571.5279 292.5878,-559.9442 274.2735,-549.6034" fill="none" stroke="#000000"></path><polygon fill="#000000" points="275.9115,-546.5089 265.4828,-544.6399 272.4698,-552.6044 275.9115,-546.5089" stroke="#000000"></polygon></g><!-- 140175854581184 --><g class="node" id="node4"><title>140175854581184</title>
<polygon fill="none" points="373,-498.5 373,-544.5 664,-544.5 664,-498.5 373,-498.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="434" y="-517.8">log_var: Dense</text><polyline fill="none" points="495,-498.5 495,-544.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="529" y="-529.3">input:</text><polyline fill="none" points="495,-521.5 563,-521.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="529" y="-506.3">output:</text><polyline fill="none" points="563,-498.5 563,-544.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="613.5" y="-529.3">(None, 256)</text><polyline fill="none" points="563,-521.5 664,-521.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="613.5" y="-506.3">(None, 2)</text></g><!-- 140175854580456&#45;&gt;140175854581184 --><g class="edge" id="edge3"><title>140175854580456-&gt;140175854581184</title>
<path d="M412.4477,-581.3799C429.8963,-571.5279 450.4122,-559.9442 468.7265,-549.6034" fill="none" stroke="#000000"></path><polygon fill="#000000" points="470.5302,-552.6044 477.5172,-544.6399 467.0885,-546.5089 470.5302,-552.6044" stroke="#000000"></polygon></g><!-- 140175854990168 --><g class="node" id="node5"><title>140175854990168</title>
<polygon fill="none" points="161.5,-415.5 161.5,-461.5 581.5,-461.5 581.5,-415.5 161.5,-415.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="252.5" y="-434.8">kl: KLDivergenceLayer</text><polyline fill="none" points="343.5,-415.5 343.5,-461.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="377.5" y="-446.3">input:</text><polyline fill="none" points="343.5,-438.5 411.5,-438.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="377.5" y="-423.3">output:</text><polyline fill="none" points="411.5,-415.5 411.5,-461.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="496.5" y="-446.3">[(None, 2), (None, 2)]</text><polyline fill="none" points="411.5,-438.5 581.5,-438.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="496.5" y="-423.3">[(None, 2), (None, 2)]</text></g><!-- 140175854580512&#45;&gt;140175854990168 --><g class="edge" id="edge4"><title>140175854580512-&gt;140175854990168</title>
<path d="M265.4477,-498.3799C282.8963,-488.5279 303.4122,-476.9442 321.7265,-466.6034" fill="none" stroke="#000000"></path><polygon fill="#000000" points="323.5302,-469.6044 330.5172,-461.6399 320.0885,-463.5089 323.5302,-469.6044" stroke="#000000"></polygon></g><!-- 140175854581184&#45;&gt;140175854990168 --><g class="edge" id="edge5"><title>140175854581184-&gt;140175854990168</title>
<path d="M477.5523,-498.3799C460.1037,-488.5279 439.5878,-476.9442 421.2735,-466.6034" fill="none" stroke="#000000"></path><polygon fill="#000000" points="422.9115,-463.5089 412.4828,-461.6399 419.4698,-469.6044 422.9115,-463.5089" stroke="#000000"></polygon></g><!-- 140176957339800 --><g class="node" id="node6"><title>140176957339800</title>
<polygon fill="none" points="0,-332.5 0,-378.5 277,-378.5 277,-332.5 0,-332.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="63" y="-351.8">sigma: Lambda</text><polyline fill="none" points="126,-332.5 126,-378.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="160" y="-363.3">input:</text><polyline fill="none" points="126,-355.5 194,-355.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="160" y="-340.3">output:</text><polyline fill="none" points="194,-332.5 194,-378.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="235.5" y="-363.3">(None, 2)</text><polyline fill="none" points="194,-355.5 277,-355.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="235.5" y="-340.3">(None, 2)</text></g><!-- 140175854990168&#45;&gt;140176957339800 --><g class="edge" id="edge6"><title>140175854990168-&gt;140176957339800</title>
<path d="M306.9059,-415.4901C277.7397,-405.1004 243.1176,-392.7672 212.8731,-381.9934" fill="none" stroke="#000000"></path><polygon fill="#000000" points="213.8144,-378.6134 203.2197,-378.5547 211.4654,-385.2075 213.8144,-378.6134" stroke="#000000"></polygon></g><!-- 140175854993136 --><g class="node" id="node9"><title>140175854993136</title>
<polygon fill="none" points="341.5,-166.5 341.5,-212.5 641.5,-212.5 641.5,-166.5 341.5,-166.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="372.5" y="-185.8">z: Add</text><polyline fill="none" points="403.5,-166.5 403.5,-212.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="437.5" y="-197.3">input:</text><polyline fill="none" points="403.5,-189.5 471.5,-189.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="437.5" y="-174.3">output:</text><polyline fill="none" points="471.5,-166.5 471.5,-212.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="556.5" y="-197.3">[(None, 2), (None, 2)]</text><polyline fill="none" points="471.5,-189.5 641.5,-189.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="556.5" y="-174.3">(None, 2)</text></g><!-- 140175854990168&#45;&gt;140175854993136 --><g class="edge" id="edge9"><title>140175854990168-&gt;140175854993136</title>
<path d="M504.1267,-415.4536C541.5042,-406.1117 575.1263,-393.9488 586.5,-379 621.4849,-333.0182 614.485,-299.5481 586.5,-249 579.6735,-236.6696 569.1065,-226.5538 557.4616,-218.3865" fill="none" stroke="#000000"></path><polygon fill="#000000" points="559.1226,-215.2919 548.8299,-212.7799 555.3096,-221.1623 559.1226,-215.2919" stroke="#000000"></polygon></g><!-- 140175854990000 --><g class="node" id="node8"><title>140175854990000</title>
<polygon fill="none" points="179,-249.5 179,-295.5 578,-295.5 578,-249.5 179,-249.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="259.5" y="-268.8">sigma_eps: Multiply</text><polyline fill="none" points="340,-249.5 340,-295.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="374" y="-280.3">input:</text><polyline fill="none" points="340,-272.5 408,-272.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="374" y="-257.3">output:</text><polyline fill="none" points="408,-249.5 408,-295.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="493" y="-280.3">[(None, 2), (None, 2)]</text><polyline fill="none" points="408,-272.5 578,-272.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="493" y="-257.3">(None, 2)</text></g><!-- 140176957339800&#45;&gt;140175854990000 --><g class="edge" id="edge7"><title>140176957339800-&gt;140175854990000</title>
<path d="M205.0347,-332.4901C235.2072,-322.0554 271.0482,-309.6604 302.2969,-298.8536" fill="none" stroke="#000000"></path><polygon fill="#000000" points="303.5291,-302.1309 311.8359,-295.5547 301.2411,-295.5154 303.5291,-302.1309" stroke="#000000"></polygon></g><!-- 140175854990224 --><g class="node" id="node7"><title>140175854990224</title>
<polygon fill="none" points="295.5,-332.5 295.5,-378.5 577.5,-378.5 577.5,-332.5 295.5,-332.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="361" y="-351.8">eps: InputLayer</text><polyline fill="none" points="426.5,-332.5 426.5,-378.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="460.5" y="-363.3">input:</text><polyline fill="none" points="426.5,-355.5 494.5,-355.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="460.5" y="-340.3">output:</text><polyline fill="none" points="494.5,-332.5 494.5,-378.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="536" y="-363.3">(None, 2)</text><polyline fill="none" points="494.5,-355.5 577.5,-355.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="536" y="-340.3">(None, 2)</text></g><!-- 140175854990224&#45;&gt;140175854990000 --><g class="edge" id="edge8"><title>140175854990224-&gt;140175854990000</title>
<path d="M420.3438,-332.3799C414.236,-323.6394 407.1756,-313.5358 400.6144,-304.1465" fill="none" stroke="#000000"></path><polygon fill="#000000" points="403.3677,-301.9762 394.7708,-295.784 397.6298,-305.9858 403.3677,-301.9762" stroke="#000000"></polygon></g><!-- 140175854990000&#45;&gt;140175854993136 --><g class="edge" id="edge10"><title>140175854990000-&gt;140175854993136</title>
<path d="M409.9768,-249.3799C422.8479,-239.9259 437.8901,-228.8772 451.5246,-218.8625" fill="none" stroke="#000000"></path><polygon fill="#000000" points="453.8125,-221.5247 459.8001,-212.784 449.6686,-215.883 453.8125,-221.5247" stroke="#000000"></polygon></g><!-- 140175847490392 --><g class="node" id="node10"><title>140175847490392</title>
<polygon fill="none" points="315,-83.5 315,-129.5 668,-129.5 668,-83.5 315,-83.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="407" y="-102.8">decoder_hidden: Dense</text><polyline fill="none" points="499,-83.5 499,-129.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="533" y="-114.3">input:</text><polyline fill="none" points="499,-106.5 567,-106.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="533" y="-91.3">output:</text><polyline fill="none" points="567,-83.5 567,-129.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="617.5" y="-114.3">(None, 2)</text><polyline fill="none" points="567,-106.5 668,-106.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="617.5" y="-91.3">(None, 256)</text></g><!-- 140175854993136&#45;&gt;140175847490392 --><g class="edge" id="edge11"><title>140175854993136-&gt;140175847490392</title>
<path d="M491.5,-166.3799C491.5,-158.1745 491.5,-148.7679 491.5,-139.8786" fill="none" stroke="#000000"></path><polygon fill="#000000" points="495.0001,-139.784 491.5,-129.784 488.0001,-139.784 495.0001,-139.784" stroke="#000000"></polygon></g><!-- 140175853700600 --><g class="node" id="node11"><title>140175853700600</title>
<polygon fill="none" points="344.5,-.5 344.5,-46.5 638.5,-46.5 638.5,-.5 344.5,-.5" stroke="#000000"></polygon><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="407" y="-19.8">x_mean: Dense</text><polyline fill="none" points="469.5,-.5 469.5,-46.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="503.5" y="-31.3">input:</text><polyline fill="none" points="469.5,-23.5 537.5,-23.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="503.5" y="-8.3">output:</text><polyline fill="none" points="537.5,-.5 537.5,-46.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="588" y="-31.3">(None, 256)</text><polyline fill="none" points="537.5,-23.5 638.5,-23.5 " stroke="#000000"></polyline><text fill="#000000" font-family="Times,serif" font-size="14.00" text-anchor="middle" x="588" y="-8.3">(None, 784)</text></g><!-- 140175847490392&#45;&gt;140175853700600 --><g class="edge" id="edge12"><title>140175847490392-&gt;140175853700600</title>
<path d="M491.5,-83.3799C491.5,-75.1745 491.5,-65.7679 491.5,-56.8786" fill="none" stroke="#000000"></path><polygon fill="#000000" points="495.0001,-56.784 491.5,-46.784 488.0001,-56.784 495.0001,-56.784" stroke="#000000"></polygon></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [69]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">vae</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/vae_full.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_model</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">vae</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">to_file</span><span class="o">=</span><span class="s1">'../../images/vae/vae_full_shapes.svg'</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [72]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">original_dim</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">original_dim</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

        </div>
        <!--End of body content-->
      </div>
    </div>

    <footer id="footer" class="footer">
        
Contents © 2017
<a href="mailto:louistiao@me.com">Louis Tiao</a> - Powered by
<a href="https://getnikola.com" rel="nofollow">Nikola</a>


<span class="pull-right">

  <a class="twitter-follow-button" href="https://twitter.com/louistiao" data-show-count="false" data-show-screen-name="false">
  Follow @louistiao
  </a>

  <a class="github-button" href="https://github.com/ltiao" aria-label="Follow @ltiao on GitHub" data-show-count="false">
  Follow @ltiao
  </a>

  <a href="https://ko-fi.com/A3476EX">
    <object type="image/svg+xml" style="pointer-events: none;" data="https://img.shields.io/badge/Support--yellow.svg?style=social"></object>
  </a>

</span>


            
    </footer>
</div> <!-- /container -->

            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><!-- Google Analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43722566-1', 'auto');
  ga('send', 'pageview');

</script><!-- GitHub Buttons --><script async defer src="https://buttons.github.io/buttons.js"></script><!-- Twitter Widgets --><script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>
</body>
</html>
