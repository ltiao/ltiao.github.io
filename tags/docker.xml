<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Louis Tiao (docker)</title><link>http://louistiao.me/</link><description></description><atom:link rel="self" href="http://louistiao.me/tags/docker.xml" type="application/rss+xml"></atom:link><language>en</language><lastBuildDate>Fri, 01 Jul 2016 03:58:53 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Deploying Flask with Redis Queue (RQ) Workers using Kubernetes</title><link>http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;img alt="../../images/rq-dashboard.png" class="align-center" src="http://louistiao.me/images/rq-dashboard.png"&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title first"&gt;Contents&lt;/p&gt;
&lt;ul class="auto-toc simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#deploy-the-redis-master" id="id4"&gt;1   Deploy the Redis master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#deploy-the-flask-web-app" id="id5"&gt;2   Deploy the Flask web app&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#requirements-txt" id="id6"&gt;2.1   requirements.txt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#settings-py" id="id7"&gt;2.2   settings.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#app-py" id="id8"&gt;2.3   app.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#dockerfile" id="id9"&gt;2.4   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#web-flask-deployment-yaml" id="id10"&gt;2.5   web-flask-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#web-flask-service-yaml" id="id11"&gt;2.6   web-flask-service.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#deploy-the-redis-queue-rq-workers" id="id12"&gt;3   Deploy the Redis Queue (RQ) workers&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id1" id="id13"&gt;3.1   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#rq-worker-deployment-yaml" id="id14"&gt;3.2   rq-worker-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#testing-it-out" id="id15"&gt;4   Testing it out&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#rq-dashboard-optional" id="id16"&gt;5   RQ Dashboard (Optional)&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id2" id="id17"&gt;5.1   requirements.txt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id3" id="id18"&gt;5.2   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#rq-dashboard-deployment-yaml" id="id19"&gt;5.3   rq-dashboard-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#rq-dashboard-service-yaml" id="id20"&gt;5.4   rq-dashboard-service.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#alternative-solution-integrate-the-dashboard-in-our-flask-app" id="id21"&gt;5.5   Alternative Solution: Integrate the Dashboard in our Flask app&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_bdf521a5795b4b499cbfc0d80f27a619-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir flask-redis-queue
&lt;a name="rest_code_bdf521a5795b4b499cbfc0d80f27a619-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; flask-redis-queue
&lt;/pre&gt;&lt;div class="section" id="deploy-the-redis-master"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id4"&gt;1   Deploy the Redis master&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_b4d004dea9c54aa29303cb59023ea193-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run redis-master --image&lt;span class="o"&gt;=&lt;/span&gt;redis --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;6379&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_b4d004dea9c54aa29303cb59023ea193-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=redis,role=master,tier=backend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_b4d004dea9c54aa29303cb59023ea193-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_b4d004dea9c54aa29303cb59023ea193-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; redis-master-deployment.yaml
&lt;/pre&gt;&lt;pre class="code yaml"&gt;&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-28"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-29"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-30"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-32"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-33"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_79d4fccf5c9c41bb8862f4e96076ac86-35"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_8fb9d19bd6c545b6978ccd567f412b00-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f redis-master-deployment.yaml
&lt;a name="rest_code_8fb9d19bd6c545b6978ccd567f412b00-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "redis-master" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_97c280fe3b4343af94d1003e9279f43e-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment redis-master --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=redis,role=master,tier=backend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_97c280fe3b4343af94d1003e9279f43e-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                        --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; redis-master-service.yaml
&lt;/pre&gt;&lt;pre class="code yaml"&gt;&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-12"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-14"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-18"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-19"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27700c17bb25479aac6abb9ebb201e2d-20"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_4f400676b4db4bebaf13d5c1a46e9b67-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f redis-master-service.yaml
&lt;a name="rest_code_4f400676b4db4bebaf13d5c1a46e9b67-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "redis-master" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="deploy-the-flask-web-app"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id5"&gt;2   Deploy the Flask web app&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_35f2ce5c5f48452ea180499545948de8-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir web-flask
&lt;/pre&gt;&lt;div class="section" id="requirements-txt"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id6"&gt;2.1   requirements.txt&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_e247fd6075144d458cce318398201335-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;gt; web-flask/requirements.txt
&lt;a name="rest_code_e247fd6075144d458cce318398201335-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_e247fd6075144d458cce318398201335-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_e247fd6075144d458cce318398201335-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="settings-py"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id7"&gt;2.2   settings.py&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_14c47c02621d43adb2425b4507fc7b09-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/settings.py
&lt;/pre&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_516ccc32e89c44898ed2e03ddc63983b-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;a name="rest_code_516ccc32e89c44898ed2e03ddc63983b-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_516ccc32e89c44898ed2e03ddc63983b-3"&gt;&lt;/a&gt;&lt;span class="n"&gt;REDIS_HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'REDIS_MASTER_SERVICE_HOST'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; \
&lt;a name="rest_code_516ccc32e89c44898ed2e03ddc63983b-4"&gt;&lt;/a&gt;          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GET_HOSTS_FROM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'env'&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="s1"&gt;'redis-master'&lt;/span&gt;
&lt;a name="rest_code_516ccc32e89c44898ed2e03ddc63983b-5"&gt;&lt;/a&gt;&lt;span class="n"&gt;REDIS_PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;6379&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="app-py"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id8"&gt;2.3   app.py&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_d947e02a223949438755b245fc46017b-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/app.py
&lt;/pre&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-2"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;redis&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StrictRedis&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-3"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rq&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Queue&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-4"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-5"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;randrange&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-7"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;settings&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;REDIS_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;REDIS_PORT&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-10"&gt;&lt;/a&gt;&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-12"&gt;&lt;/a&gt;&lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;StrictRedis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;REDIS_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;REDIS_PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-14"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-15"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-16"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_randrange&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-18"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;'stop'&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-19"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-20"&gt;&lt;/a&gt;        &lt;span class="n"&gt;stop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'stop'&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-21"&gt;&lt;/a&gt;        &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'start'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-22"&gt;&lt;/a&gt;        &lt;span class="n"&gt;step&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'step'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-23"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-24"&gt;&lt;/a&gt;        &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enqueue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randrange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result_ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-25"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-26"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_id&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-27"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-28"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Stop value not specified!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-29"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-30"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-31"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"/results"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-32"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"/results/&amp;lt;string:job_id&amp;gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-33"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_results&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-34"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-35"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job_id&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-36"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queued_job_ids&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;job_ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-37"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-38"&gt;&lt;/a&gt;    &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetch_job&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-39"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-40"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-41"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Job has failed!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-42"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-43"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_finished&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-44"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-45"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-46"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Job has not finished!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;202&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-47"&gt;&lt;/a&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-48"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'__main__'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-49"&gt;&lt;/a&gt;    &lt;span class="c1"&gt;# Start server&lt;/span&gt;
&lt;a name="rest_code_a2c10d7325da494aa67562d377c8bed4-50"&gt;&lt;/a&gt;    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'0.0.0.0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8080&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="dockerfile"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id9"&gt;2.4   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_3d33fb19ebf4409aad65c93481a0d286-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/Dockerfile
&lt;/pre&gt;&lt;div class="attention"&gt;
&lt;p class="first admonition-title"&gt;Attention!&lt;/p&gt;
&lt;p class="last"&gt;Not suitable for production!&lt;/p&gt;
&lt;/div&gt;
&lt;pre class="code docker"&gt;&lt;a name="rest_code_a36736e389e048d6a527168da2f1fd57-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; python:3.5.1-onbuild&lt;/span&gt;
&lt;a name="rest_code_a36736e389e048d6a527168da2f1fd57-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_a36736e389e048d6a527168da2f1fd57-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 8080&lt;/span&gt;
&lt;a name="rest_code_a36736e389e048d6a527168da2f1fd57-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["python", "app.py"]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_21fea6ebdb0f46419df2e5140d9461ef-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/web-flask-rq:v1 web-flask
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_1f930cdf7a3b4d1e9254041d6e5e9082-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run web-flask --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/web-flask-rq:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_1f930cdf7a3b4d1e9254041d6e5e9082-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=flask,tier=frontend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_1f930cdf7a3b4d1e9254041d6e5e9082-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_1f930cdf7a3b4d1e9254041d6e5e9082-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=dns"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_1f930cdf7a3b4d1e9254041d6e5e9082-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; web-flask-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="web-flask-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id10"&gt;2.5   web-flask-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-8"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-9"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-10"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-12"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-13"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-16"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-18"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-19"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-20"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-21"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-22"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-23"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-24"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-25"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-26"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dns&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-27"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-28"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-29"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-30"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-32"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-33"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_103465831a3740e2a2f2cc4e9c9c3d47-35"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_fca0466fbd8b4cbfb3c8282a364ae525-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f web-flask-deployment.yaml
&lt;a name="rest_code_fca0466fbd8b4cbfb3c8282a364ae525-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "web-flask" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_022227e456984c67bdaca4c4991b5929-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment web-flask --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=flask,tier=frontend'&lt;/span&gt; --type&lt;span class="o"&gt;=&lt;/span&gt;NodePort &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_022227e456984c67bdaca4c4991b5929-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                     --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; web-flask-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="web-flask-service-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id11"&gt;2.6   web-flask-service.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-8"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-9"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-10"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-11"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-12"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-14"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-15"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;type&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NodePort&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-18"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_9c33bcd52ece4b56bd158285be30ae62-19"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f web-flask-service.yaml
&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;You have exposed your service on an external port on all nodes in your&lt;/span&gt;
&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;cluster.  If you want to expose this service to the external internet, you may&lt;/span&gt;
&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;need to set up firewall rules for the service port(s) (tcp:30321) to serve traffic.&lt;/span&gt;
&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-5"&gt;&lt;/a&gt;
&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.&lt;/span&gt;
&lt;a name="rest_code_d59e8c048f064de3a53c56a88d251463-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "web-flask" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="deploy-the-redis-queue-rq-workers"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id12"&gt;3   Deploy the Redis Queue (RQ) workers&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_0efcc19be7114de38479748b0b108002-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir rq-worker
&lt;/pre&gt;&lt;div class="section" id="id1"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id13"&gt;3.1   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code docker"&gt;&lt;a name="rest_code_7a02fecb6cbc434b916a67adbdbd63b1-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_7a02fecb6cbc434b916a67adbdbd63b1-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_7a02fecb6cbc434b916a67adbdbd63b1-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["rq", "worker", "--config", "settings"]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_7c9016a7f3944574a50a346fb8e1d243-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/rq-worker:v1 rq-worker
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_af3d22e0345d4e6aa10965aa938fc447-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run rq-worker --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/rq-worker:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_af3d22e0345d4e6aa10965aa938fc447-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"app=rq,role=worker,tier=backend"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_af3d22e0345d4e6aa10965aa938fc447-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"cpu=100m,memory=100Mi"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_af3d22e0345d4e6aa10965aa938fc447-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=dns"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_af3d22e0345d4e6aa10965aa938fc447-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-worker-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-worker-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id14"&gt;3.2   rq-worker-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-worker&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-28"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-29"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dns&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-30"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/rq-worker:v1&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-worker&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-32"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-33"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-35"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_00156abe792c4dc1a967b3eaf7f401d9-36"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_80049908ebae471d9a4bb1edf54dcbbd-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-worker-deployment.yaml
&lt;a name="rest_code_80049908ebae471d9a4bb1edf54dcbbd-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "rq-worker" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="testing-it-out"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id15"&gt;4   Testing it out&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We make make use of &lt;a class="reference external" href="http://kubernetes.io/docs/user-guide/jsonpath/"&gt;JSONPath support&lt;/a&gt;
in the &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; tool to query the &lt;tt class="docutils literal"&gt;NodePort&lt;/tt&gt; for our &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;web-flask&lt;/span&gt;&lt;/tt&gt; service:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_bbba9998ddfb4862a68fa9eadc2972dd-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get service web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;
&lt;a name="rest_code_bbba9998ddfb4862a68fa9eadc2972dd-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;30321%&lt;/span&gt;
&lt;a name="rest_code_bbba9998ddfb4862a68fa9eadc2972dd-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;kubectl get service web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;We construct the address for ease of reference later on:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_04afb4b518524c32b91a1ca3954f32ed-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;minikube ip&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="nv"&gt;$port&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;a name="rest_code_04afb4b518524c32b91a1ca3954f32ed-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$address&lt;/span&gt;
&lt;a name="rest_code_04afb4b518524c32b91a1ca3954f32ed-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;192.168.99.101:31637&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_41447e44b10e458a9f6fa3dc84148020-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=23&amp;amp;stop=31"&lt;/span&gt;
&lt;/pre&gt;&lt;img alt="../../images/flask-rq-job.png" class="align-center" src="http://louistiao.me/images/flask-rq-job.png"&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_7baa91ba2bd744e881fe5bfd8d44f57a-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=41&amp;amp;stop=45"&lt;/span&gt;
&lt;a name="rest_code_7baa91ba2bd744e881fe5bfd8d44f57a-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;{&lt;/span&gt;
&lt;a name="rest_code_7baa91ba2bd744e881fe5bfd8d44f57a-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;  "job_id": "cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;a name="rest_code_7baa91ba2bd744e881fe5bfd8d44f57a-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;}&lt;/span&gt;
&lt;a name="rest_code_7baa91ba2bd744e881fe5bfd8d44f57a-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=41&amp;amp;stop=45"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.job_id'&lt;/span&gt;
&lt;a name="rest_code_7baa91ba2bd744e881fe5bfd8d44f57a-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;"cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_5544b1c778d64eb9a2626865c3fa5c51-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;a name="rest_code_5544b1c778d64eb9a2626865c3fa5c51-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;{&lt;/span&gt;
&lt;a name="rest_code_5544b1c778d64eb9a2626865c3fa5c51-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;  "result": 43&lt;/span&gt;
&lt;a name="rest_code_5544b1c778d64eb9a2626865c3fa5c51-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;}&lt;/span&gt;
&lt;a name="rest_code_5544b1c778d64eb9a2626865c3fa5c51-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.result'&lt;/span&gt;
&lt;a name="rest_code_5544b1c778d64eb9a2626865c3fa5c51-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;43&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_905a06313b0241d5a9cfe41cf4f9a2d3-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=53&amp;amp;stop=45"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.job_id'&lt;/span&gt;
&lt;a name="rest_code_905a06313b0241d5a9cfe41cf4f9a2d3-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;"252b14a4-4a9e-45eb-8834-9e2078fb94ed"&lt;/span&gt;
&lt;a name="rest_code_905a06313b0241d5a9cfe41cf4f9a2d3-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/252b14a4-4a9e-45eb-8834-9e2078fb94ed"&lt;/span&gt;
&lt;a name="rest_code_905a06313b0241d5a9cfe41cf4f9a2d3-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;Job has failed!%&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-optional"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id16"&gt;5   RQ Dashboard (Optional)&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_162a9006c3d74cc1a9f55f8a7525e9cb-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir rq-dashboard
&lt;/pre&gt;&lt;div class="section" id="id2"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id17"&gt;5.1   requirements.txt&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_4b82c044864f4dd0946d99058781b1f7-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; rq-dashboard &amp;gt; rq-dashboard/requirements.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id18"&gt;5.2   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_a4e4a27c1e7b419f9e9eba5b20d9b34e-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; rq-dashboard/Dockerfile
&lt;/pre&gt;&lt;pre class="code docker"&gt;&lt;a name="rest_code_63487981246d4a919ec76f8410411492-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; python:3.5.1-onbuild&lt;/span&gt;
&lt;a name="rest_code_63487981246d4a919ec76f8410411492-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_63487981246d4a919ec76f8410411492-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 9181&lt;/span&gt;
&lt;a name="rest_code_63487981246d4a919ec76f8410411492-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["rq-dashboard", "--port", "9181", \&lt;/span&gt;
&lt;a name="rest_code_63487981246d4a919ec76f8410411492-5"&gt;&lt;/a&gt;                     &lt;span class="s2"&gt;"--redis-host"&lt;/span&gt;, &lt;span class="s2"&gt;"redis-master"&lt;/span&gt;, &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_63487981246d4a919ec76f8410411492-6"&gt;&lt;/a&gt;                     &lt;span class="s2"&gt;"--redis-port"&lt;/span&gt;, &lt;span class="s2"&gt;"6379"&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_c54699d871f84cd79012ec46565cf925-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/rq-dashboard:v1 rq-dashboard
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d72980cffa1d47afac59dbc8b440810b-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run rq-dashboard --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/rq-dashboard:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9181&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_d72980cffa1d47afac59dbc8b440810b-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=rq,role=dashboard,tier=frontend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_d72980cffa1d47afac59dbc8b440810b-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_d72980cffa1d47afac59dbc8b440810b-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=env"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_d72980cffa1d47afac59dbc8b440810b-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-dashboard-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id19"&gt;5.3   rq-dashboard-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-28"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-29"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-30"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/rq-dashboard:v1&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-32"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-33"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-34"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-35"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-36"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-37"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_27a345fc498448c1a69f90ed65c2d8c5-38"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_c29285f624b84bda988754b338bb7ca3-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-dashboard-deployment.yaml
&lt;a name="rest_code_c29285f624b84bda988754b338bb7ca3-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "rq-dashboard" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_3dfbf59f07f245778baa2fa9377b0daf-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment rq-dashboard --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=rq,role=dashboard,tier=frontend'&lt;/span&gt; --type&lt;span class="o"&gt;=&lt;/span&gt;NodePort &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_3dfbf59f07f245778baa2fa9377b0daf-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                        --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-dashboard-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-service-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id20"&gt;5.4   rq-dashboard-service.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-12"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-14"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-18"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-19"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;type&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NodePort&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-20"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_46ca5d32693a463db8ad36f9857abb35-21"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-dashboard-service.yaml
&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;You have exposed your service on an external port on all nodes in your&lt;/span&gt;
&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;cluster.  If you want to expose this service to the external internet, you may&lt;/span&gt;
&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;need to set up firewall rules for the service port(s) (tcp:30645) to serve traffic.&lt;/span&gt;
&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-5"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.&lt;/span&gt;
&lt;a name="rest_code_8e82a7432105405c8179804d2cc09030-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "rq-dashboard" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_52a5eb0663e148d992370ab85c7dffc0-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;minikube ip&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;kubectl get service rq-dashboard --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;/pre&gt;&lt;a class="reference external image-reference" href="http://louistiao.me/images/rq-dashboard-failed.png"&gt;&lt;img alt="../../images/rq-dashboard-failed.thumbnail.png" class="align-center" src="http://louistiao.me/images/rq-dashboard-failed.thumbnail.png"&gt;&lt;/a&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get pods
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;NAME                            READY     STATUS    RESTARTS   AGE&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;redis-master-2576299852-iwf15   1/1       Running   0          52m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-dashboard-1288919851-n10qs   1/1       Running   0          20m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-5"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-bekby      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-cecxu      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-lnxha      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-8"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-nc474      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-9"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-ztmuq      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_c4dd1d1c8b79499d9e6e633516bfed98-10"&gt;&lt;/a&gt;&lt;span class="go"&gt;web-flask-338777398-21dli       1/1       Running   0          47m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="alternative-solution-integrate-the-dashboard-in-our-flask-app"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/#id21"&gt;5.5   Alternative Solution: Integrate the Dashboard in our Flask app&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code diff"&gt;&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask/app.py b/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index af6ec48..ec7c1cd 100644&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -4,12 +4,16 @@ from rq import Queue&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-7"&gt;&lt;/a&gt; from random import randrange
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-9"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-from settings import REDIS_HOST, REDIS_PORT&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-10"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-11"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+import rq_dashboard&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-12"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+import settings&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-14"&gt;&lt;/a&gt; app = Flask(__name__)
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-15"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.config.from_object(rq_dashboard.default_settings)&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-16"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.config.from_object(settings)&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-17"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.register_blueprint(rq_dashboard.blueprint, url_prefix='/dashboard')&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-18"&gt;&lt;/a&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-19"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-q = Queue(connection=StrictRedis(host=REDIS_HOST, port=REDIS_PORT))&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-20"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+q = Queue(connection=StrictRedis(host=settings.REDIS_HOST,&lt;/span&gt;
&lt;a name="rest_code_22d9a418fa334d9aa18094942a51e39a-21"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+                                 port=settings.REDIS_PORT))&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code diff"&gt;&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask/requirements.txt b/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index 17dba2a..fcb5d58 100644&lt;/span&gt;
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -1,3 +1,4 @@&lt;/span&gt;
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-6"&gt;&lt;/a&gt; flask
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-7"&gt;&lt;/a&gt; redis
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-8"&gt;&lt;/a&gt; rq
&lt;a name="rest_code_09d6a9ae58d041d0a43fd65dfb388834-9"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+rq-dashboard&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_9e6f5bdde55c4a2fb90cfa0b99df4ee5-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/web-flask-rq:v2 web-flask
&lt;/pre&gt;&lt;pre class="code diff"&gt;&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask-deployment.yaml b/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index a4524e6..2dc5356 100644&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -24,7 +24,7 @@ spec:&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-6"&gt;&lt;/a&gt;       - env:
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-7"&gt;&lt;/a&gt;         - name: GET_HOSTS_FROM
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-8"&gt;&lt;/a&gt;           value: dns
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-9"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-        image: tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-10"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+        image: tiao/web-flask-rq:v2&lt;/span&gt;
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-11"&gt;&lt;/a&gt;         name: web-flask
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-12"&gt;&lt;/a&gt;         ports:
&lt;a name="rest_code_8196128d44f04659bbec76c9f3726379-13"&gt;&lt;/a&gt;         - containerPort: 8080
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_467ec6d06f784e8c985f9655a5859318-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl apply -f web-flask-deployment.yaml
&lt;a name="rest_code_467ec6d06f784e8c985f9655a5859318-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "web-flask" configured&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_ff66abfcd0904e6689570fae1a19827b-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get deployment web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.template.spec.containers[*].image}'&lt;/span&gt;
&lt;a name="rest_code_ff66abfcd0904e6689570fae1a19827b-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;tiao/web-flask-rq:v2%&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_deb94fd5bfd6486a9d8aaa25bb174243-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/dashboard"&lt;/span&gt;
&lt;/pre&gt;&lt;a class="reference external image-reference" href="http://louistiao.me/images/rq-dashboard-failed-flask.png"&gt;&lt;img alt="../../images/rq-dashboard-failed-flask.thumbnail.png" class="align-center" src="http://louistiao.me/images/rq-dashboard-failed-flask.thumbnail.png"&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>docker</category><category>flask</category><category>kubernetes</category><category>redis</category><category>rq</category><guid>http://louistiao.me/posts/deploying-flask-with-redis-queue-rq-workers-using-kubernetes/</guid><pubDate>Thu, 30 Jun 2016 00:42:25 GMT</pubDate></item><item><title>Re-implementing the Kubernetes Guestbook Example with Flask and NGINX</title><link>http://louistiao.me/posts/re-implementing-the-kubernetes-guestbook-example-with-flask-and-nginx/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;p&gt;The official &lt;a class="reference external" href="http://kubernetes.io/"&gt;Kubernetes&lt;/a&gt; &lt;a class="reference external" href="http://kubernetes.io/docs/user-guide/walkthrough/"&gt;walkthrough guides&lt;/a&gt; often points to the &lt;a class="reference external" href="https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook"&gt;guestbook
application&lt;/a&gt; as a quintessential example of how a simple, but complete multi-tier
web application can be deployed with Kubernetes. As described in the &lt;a class="reference external" href="https://github.com/kubernetes/kubernetes/blob/master/examples/guestbook/README.md"&gt;README&lt;/a&gt;, it
consists of a web frontend, a redis master (for storage), and a replicated set of
redis 'slaves'.&lt;/p&gt;
&lt;img alt="//cloud.google.com/container-engine/images/guestbook.png" class="align-center" src="//cloud.google.com/container-engine/images/guestbook.png"&gt;
&lt;p&gt;This seemed like an ideal starting point for deploying my &lt;a class="reference external" href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; applications
with a similar stack, and also makes use of redis master/slaves. The difficulty
I found with readily making use of this example as a starting point is that the
frontend is implemented in PHP, which is considerably different to modern paradigms
(Node.js, Flask/Django, Rails, etc.) As described in the README:&lt;/p&gt;
&lt;blockquote&gt;
A frontend pod is a simple PHP server that is configured to talk to either
the slave or master services, depending on whether the client request is a
read or a write. It exposes a simple AJAX interface, and serves an
Angular-based UX. Again we'll create a set of replicated frontend pods
instantiated by a Deployment — this time, with three replicas.&lt;/blockquote&gt;
&lt;p&gt;I figured re-implementing the frontend pod in with Flask would require minimal
changes - the UI would remain mostly the same, and the actual interaction with
the redis master/slaves is quite trivial.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://louistiao.me/posts/re-implementing-the-kubernetes-guestbook-example-with-flask-and-nginx/"&gt;Read more…&lt;/a&gt; (8 min remaining to read)&lt;/p&gt;&lt;/div&gt;</description><category>angularjs</category><category>docker</category><category>flask</category><category>html</category><category>kubernetes</category><category>nginx</category><category>redis</category><category>uwsgi</category><guid>http://louistiao.me/posts/re-implementing-the-kubernetes-guestbook-example-with-flask-and-nginx/</guid><pubDate>Wed, 25 May 2016 04:10:00 GMT</pubDate></item></channel></rss>