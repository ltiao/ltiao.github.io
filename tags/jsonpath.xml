<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Louis Tiao (jsonpath)</title><link>http://louistiao.me/</link><description></description><atom:link type="application/rss+xml" rel="self" href="http://louistiao.me/tags/jsonpath.xml"></atom:link><language>en</language><lastBuildDate>Fri, 01 Jul 2016 04:13:14 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Walkthrough: Deploying a Flask app with Redis Queue (RQ) Workers and Dashboard using Kubernetes</title><link>http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/</link><dc:creator>Louis Tiao</dc:creator><description>&lt;div&gt;&lt;img alt="../../images/rq-dashboard.png" class="align-center" src="http://louistiao.me/images/rq-dashboard.png"&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title first"&gt;Contents&lt;/p&gt;
&lt;ul class="auto-toc simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#deploy-the-redis-master" id="id4"&gt;1   Deploy the Redis master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#deploy-the-flask-web-app" id="id5"&gt;2   Deploy the Flask web app&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#requirements-txt" id="id6"&gt;2.1   requirements.txt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#settings-py" id="id7"&gt;2.2   settings.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#app-py" id="id8"&gt;2.3   app.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#dockerfile" id="id9"&gt;2.4   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#web-flask-deployment-yaml" id="id10"&gt;2.5   web-flask-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#web-flask-service-yaml" id="id11"&gt;2.6   web-flask-service.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#deploy-the-redis-queue-rq-workers" id="id12"&gt;3   Deploy the Redis Queue (RQ) workers&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id1" id="id13"&gt;3.1   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-worker-deployment-yaml" id="id14"&gt;3.2   rq-worker-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#testing-it-out" id="id15"&gt;4   Testing it out&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-dashboard-optional" id="id16"&gt;5   RQ Dashboard (Optional)&lt;/a&gt;&lt;ul class="auto-toc"&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id2" id="id17"&gt;5.1   requirements.txt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id3" id="id18"&gt;5.2   Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-dashboard-deployment-yaml" id="id19"&gt;5.3   rq-dashboard-deployment.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#rq-dashboard-service-yaml" id="id20"&gt;5.4   rq-dashboard-service.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#alternative-solution-integrate-the-dashboard-in-our-flask-app" id="id21"&gt;5.5   Alternative Solution: Integrate the Dashboard in our Flask app&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_83ee9834a60741c885505f146f114174-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir flask-redis-queue
&lt;a name="rest_code_83ee9834a60741c885505f146f114174-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; flask-redis-queue
&lt;/pre&gt;&lt;div class="section" id="deploy-the-redis-master"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id4"&gt;1   Deploy the Redis master&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;a&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run redis-master --image&lt;span class="o"&gt;=&lt;/span&gt;redis --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;6379&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=redis,role=master,tier=backend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_88d85f687e294699a458b97a4496d82f-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; redis-master-deployment.yaml
&lt;/pre&gt;&lt;pre class="code yaml"&gt;&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-28"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-29"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-30"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-32"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-33"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_d9bb03c1454146bca8f8579061799455-35"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_9f5f95e803cb42ae94f8edf7d916b92a-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f redis-master-deployment.yaml
&lt;a name="rest_code_9f5f95e803cb42ae94f8edf7d916b92a-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "redis-master" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_8e7aa77a72f1498aa2f13c826201b87b-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment redis-master --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=redis,role=master,tier=backend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_8e7aa77a72f1498aa2f13c826201b87b-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                        --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; redis-master-service.yaml
&lt;/pre&gt;&lt;pre class="code yaml"&gt;&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis-master&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-12"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-14"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;6379&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;master&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-18"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-19"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_1501d9f0d1cf4cb1afd1c2f3f7da8527-20"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d40016f0c8fd4ba09410b0f17652d428-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f redis-master-service.yaml
&lt;a name="rest_code_d40016f0c8fd4ba09410b0f17652d428-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "redis-master" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="deploy-the-flask-web-app"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id5"&gt;2   Deploy the Flask web app&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_739818d6f12d4e6080290a4342cd1bf9-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir web-flask
&lt;/pre&gt;&lt;div class="section" id="requirements-txt"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id6"&gt;2.1   requirements.txt&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;gt; web-flask/requirements.txt
&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_180cc9aeb9b948f0b8e30a22c7cfed5e-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="settings-py"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id7"&gt;2.2   settings.py&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_35a831a5e2b240de8d0b06be2fdbaa06-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/settings.py
&lt;/pre&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-3"&gt;&lt;/a&gt;&lt;span class="n"&gt;REDIS_HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'REDIS_MASTER_SERVICE_HOST'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; \
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-4"&gt;&lt;/a&gt;          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GET_HOSTS_FROM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'env'&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="s1"&gt;'redis-master'&lt;/span&gt;
&lt;a name="rest_code_b47e951a70be4f029cd6ae291de792d8-5"&gt;&lt;/a&gt;&lt;span class="n"&gt;REDIS_PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;6379&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="app-py"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id8"&gt;2.3   app.py&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_1c0e903998d0439faa17e5a6a52dde02-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/app.py
&lt;/pre&gt;&lt;pre class="code python"&gt;&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-2"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;redis&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StrictRedis&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-3"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;rq&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Queue&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-4"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-5"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;randrange&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-7"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;settings&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;REDIS_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;REDIS_PORT&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-10"&gt;&lt;/a&gt;&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-12"&gt;&lt;/a&gt;&lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;StrictRedis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;REDIS_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;REDIS_PORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-14"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-15"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-16"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_randrange&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-18"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;'stop'&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-19"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-20"&gt;&lt;/a&gt;        &lt;span class="n"&gt;stop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'stop'&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-21"&gt;&lt;/a&gt;        &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'start'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-22"&gt;&lt;/a&gt;        &lt;span class="n"&gt;step&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'step'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-23"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-24"&gt;&lt;/a&gt;        &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enqueue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;randrange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result_ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-25"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-26"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_id&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-27"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-28"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Stop value not specified!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-29"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-30"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-31"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"/results"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-32"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"/results/&amp;lt;string:job_id&amp;gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-33"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_results&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-34"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-35"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job_id&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-36"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queued_job_ids&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;job_ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-37"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-38"&gt;&lt;/a&gt;    &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetch_job&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-39"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-40"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-41"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Job has failed!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-42"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-43"&gt;&lt;/a&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_finished&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-44"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;jsonify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;job&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-45"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-46"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;'Job has not finished!'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;202&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-47"&gt;&lt;/a&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-48"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'__main__'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-49"&gt;&lt;/a&gt;    &lt;span class="c1"&gt;# Start server&lt;/span&gt;
&lt;a name="rest_code_0217ca1093de4b389c1a413ee439deac-50"&gt;&lt;/a&gt;    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'0.0.0.0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8080&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="dockerfile"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id9"&gt;2.4   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_3d0dc6a1374f400dbd30c7dc7b906b89-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; web-flask/Dockerfile
&lt;/pre&gt;&lt;div class="attention"&gt;
&lt;p class="first admonition-title"&gt;Attention!&lt;/p&gt;
&lt;p class="last"&gt;Not suitable for production!&lt;/p&gt;
&lt;/div&gt;
&lt;pre class="code docker"&gt;&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; python:3.5.1-onbuild&lt;/span&gt;
&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 8080&lt;/span&gt;
&lt;a name="rest_code_9874935d1f784d6e877e9844ca37ed13-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["python", "app.py"]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_546de6d0f8bf4497b5c87a6cc2a52234-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/web-flask-rq:v1 web-flask
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run web-flask --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/web-flask-rq:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=flask,tier=frontend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=dns"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_42f04316908049b99f7b8f49d6d10925-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; web-flask-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="web-flask-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id10"&gt;2.5   web-flask-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-8"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-9"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-10"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-12"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-13"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-16"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-18"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-19"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-20"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-21"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-22"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-23"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-24"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-25"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-26"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dns&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-27"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-28"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-29"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-30"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-32"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-33"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_bbb39290d287456cb750b4f7c366484e-35"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_dc0df61b1d1e4c849d13d59af8d1bffe-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f web-flask-deployment.yaml
&lt;a name="rest_code_dc0df61b1d1e4c849d13d59af8d1bffe-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "web-flask" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_05e0127bf2464ced90209d7e07765daa-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment web-flask --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=flask,tier=frontend'&lt;/span&gt; --type&lt;span class="o"&gt;=&lt;/span&gt;NodePort &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_05e0127bf2464ced90209d7e07765daa-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                     --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; web-flask-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="web-flask-service-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id11"&gt;2.6   web-flask-service.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-8"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;web-flask&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-9"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-10"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-11"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-12"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-14"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-15"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;flask&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;type&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NodePort&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-18"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_2b2ac5aecb0a446ca0b6bb329400bfd1-19"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f web-flask-service.yaml
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;You have exposed your service on an external port on all nodes in your&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;cluster.  If you want to expose this service to the external internet, you may&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;need to set up firewall rules for the service port(s) (tcp:30321) to serve traffic.&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-5"&gt;&lt;/a&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.&lt;/span&gt;
&lt;a name="rest_code_074cd4684baf4226ab887ce1505dadbe-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "web-flask" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="deploy-the-redis-queue-rq-workers"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id12"&gt;3   Deploy the Redis Queue (RQ) workers&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_dbf988d5a703469cbbc875f3ef0d1361-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir rq-worker
&lt;/pre&gt;&lt;div class="section" id="id1"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id13"&gt;3.1   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code docker"&gt;&lt;a name="rest_code_97ffb0ab0f1645c7946d4824256f5172-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_97ffb0ab0f1645c7946d4824256f5172-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_97ffb0ab0f1645c7946d4824256f5172-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["rq", "worker", "--config", "settings"]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d50731a6aaac439cba0ff9bd7264f1b4-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/rq-worker:v1 rq-worker
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run rq-worker --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/rq-worker:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"app=rq,role=worker,tier=backend"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"cpu=100m,memory=100Mi"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=dns"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_20d8ae4d0ecf483b923c9da5169e1377-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                       --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-worker-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-worker-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id14"&gt;3.2   rq-worker-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-28"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-29"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dns&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-30"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/rq-worker:v1&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-worker&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-32"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-33"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-34"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-35"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_82e336bf3bea4de1987bb2395f3cb6a2-36"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_9fe517f1df0648379fc246092c7f21cf-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-worker-deployment.yaml
&lt;a name="rest_code_9fe517f1df0648379fc246092c7f21cf-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "rq-worker" created&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="testing-it-out"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id15"&gt;4   Testing it out&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We make make use of &lt;a class="reference external" href="http://kubernetes.io/docs/user-guide/jsonpath/"&gt;JSONPath support&lt;/a&gt;
in the &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; tool to query the &lt;tt class="docutils literal"&gt;NodePort&lt;/tt&gt; for our &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;web-flask&lt;/span&gt;&lt;/tt&gt; service:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_6ca2ce62faad4d73969ef8e4c0ea5b7f-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get service web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;
&lt;a name="rest_code_6ca2ce62faad4d73969ef8e4c0ea5b7f-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;30321%&lt;/span&gt;
&lt;a name="rest_code_6ca2ce62faad4d73969ef8e4c0ea5b7f-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;kubectl get service web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;We construct the address for ease of reference later on:&lt;/p&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_e60824d57c4c4c218ee52544930ae33c-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;minikube ip&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="nv"&gt;$port&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;a name="rest_code_e60824d57c4c4c218ee52544930ae33c-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$address&lt;/span&gt;
&lt;a name="rest_code_e60824d57c4c4c218ee52544930ae33c-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;192.168.99.101:31637&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_c072447e72b84fc7b013efe43935a221-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=23&amp;amp;stop=31"&lt;/span&gt;
&lt;/pre&gt;&lt;img alt="../../images/flask-rq-job.png" class="align-center" src="http://louistiao.me/images/flask-rq-job.png"&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_148c1db7088440318c3531a046aad632-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=41&amp;amp;stop=45"&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;{&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;  "job_id": "cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;}&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=41&amp;amp;stop=45"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.job_id'&lt;/span&gt;
&lt;a name="rest_code_148c1db7088440318c3531a046aad632-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;"cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;{&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;  "result": 43&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;}&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/cc31bdcd-ad31-41ce-b516-2b90cd92f2a1"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.result'&lt;/span&gt;
&lt;a name="rest_code_b53f8ce19a344a7b82db236c44575571-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;43&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/?start=53&amp;amp;stop=45"&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; jq &lt;span class="s1"&gt;'.job_id'&lt;/span&gt;
&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;"252b14a4-4a9e-45eb-8834-9e2078fb94ed"&lt;/span&gt;
&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/results/252b14a4-4a9e-45eb-8834-9e2078fb94ed"&lt;/span&gt;
&lt;a name="rest_code_cd5d27f0f06b473bbc40c49c6c77c831-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;Job has failed!%&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-optional"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id16"&gt;5   RQ Dashboard (Optional)&lt;/a&gt;&lt;/h2&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_206689f8238e4ec68caca346d6e9a813-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkdir rq-dashboard
&lt;/pre&gt;&lt;div class="section" id="id2"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id17"&gt;5.1   requirements.txt&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_afc0bc4c34124fc882e63c51d7426e1d-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; rq-dashboard &amp;gt; rq-dashboard/requirements.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id18"&gt;5.2   Dockerfile&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_87048734db9c4d97bf47667028365c35-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;$EDITOR&lt;/span&gt; rq-dashboard/Dockerfile
&lt;/pre&gt;&lt;pre class="code docker"&gt;&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; python:3.5.1-onbuild&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-3"&gt;&lt;/a&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 9181&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;CMD&lt;/span&gt;&lt;span class="s"&gt; ["rq-dashboard", "--port", "9181", \&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-5"&gt;&lt;/a&gt;                     &lt;span class="s2"&gt;"--redis-host"&lt;/span&gt;, &lt;span class="s2"&gt;"redis-master"&lt;/span&gt;, &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_e7055fd3764d448e9e64040b6a720e9a-6"&gt;&lt;/a&gt;                     &lt;span class="s2"&gt;"--redis-port"&lt;/span&gt;, &lt;span class="s2"&gt;"6379"&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_a309739c23f14970b6075af4f65c6e84-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/rq-dashboard:v1 rq-dashboard
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl run rq-dashboard --image&lt;span class="o"&gt;=&lt;/span&gt;tiao/rq-dashboard:v1 --replicas&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; --port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9181&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --labels&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=rq,role=dashboard,tier=frontend'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-3"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --requests&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'cpu=100m,memory=100Mi'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-4"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --env&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"GET_HOSTS_FROM=env"&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_433fb01461804b6ebbfefbbd6cf7196d-5"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                          --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-dashboard-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-deployment-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id19"&gt;5.3   rq-dashboard-deployment.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;extensions/v1beta1&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;replicas&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-12"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;matchLabels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-14"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-15"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-16"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-17"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;strategy&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-18"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;template&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-19"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-20"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-21"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-22"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-23"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-24"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-25"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-26"&gt;&lt;/a&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containers&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-27"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-28"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GET_HOSTS_FROM&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-29"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;value&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;env&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-30"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;image&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiao/rq-dashboard:v1&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-31"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-32"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-33"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;containerPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-34"&gt;&lt;/a&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;resources&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-35"&gt;&lt;/a&gt;          &lt;span class="l l-Scalar l-Scalar-Plain"&gt;requests&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-36"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100m&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-37"&gt;&lt;/a&gt;            &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;100Mi&lt;/span&gt;
&lt;a name="rest_code_af3cefef899341fb834d4db75322859f-38"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_334129999dec4101aadecc7dfae2fbbf-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-dashboard-deployment.yaml
&lt;a name="rest_code_334129999dec4101aadecc7dfae2fbbf-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "rq-dashboard" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_12162d355d4b487a92726cf456d11e58-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl expose deployment rq-dashboard --selector&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'app=rq,role=dashboard,tier=frontend'&lt;/span&gt; --type&lt;span class="o"&gt;=&lt;/span&gt;NodePort &lt;span class="se"&gt;\&lt;/span&gt;
&lt;a name="rest_code_12162d355d4b487a92726cf456d11e58-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;&amp;gt;&lt;/span&gt;                                        --dry-run --output&lt;span class="o"&gt;=&lt;/span&gt;yaml &amp;gt; rq-dashboard-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="rq-dashboard-service-yaml"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id20"&gt;5.4   rq-dashboard-service.yaml&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-1"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiVersion&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-2"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;kind&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-3"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;metadata&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-4"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;creationTimestamp&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;null&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-5"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;labels&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-6"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-7"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-8"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-9"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq-dashboard&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-10"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;spec&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-11"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ports&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-12"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-13"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;protocol&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-14"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;targetPort&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;9181&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-15"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;selector&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-16"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;app&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;rq&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-17"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;role&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;dashboard&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-18"&gt;&lt;/a&gt;    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;tier&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-19"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;type&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NodePort&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-20"&gt;&lt;/a&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;status&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
&lt;a name="rest_code_fb80b5b51b5d46cf898b4cf71b6fda82-21"&gt;&lt;/a&gt;  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;loadBalancer&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl create -f rq-dashboard-service.yaml
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;You have exposed your service on an external port on all nodes in your&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;cluster.  If you want to expose this service to the external internet, you may&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;need to set up firewall rules for the service port(s) (tcp:30645) to serve traffic.&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-5"&gt;&lt;/a&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.&lt;/span&gt;
&lt;a name="rest_code_7ec678aa29ae435386c49ed0aad9bf17-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;service "rq-dashboard" created&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_a8596bd656834bbd9a8cf696ef024455-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;minikube ip&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;kubectl get service rq-dashboard --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.ports[0].NodePort}'&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;/pre&gt;&lt;a class="reference external image-reference" href="http://louistiao.me/images/rq-dashboard-failed.png"&gt;&lt;img alt="../../images/rq-dashboard-failed.thumbnail.png" class="align-center" src="http://louistiao.me/images/rq-dashboard-failed.thumbnail.png"&gt;&lt;/a&gt;
&lt;pre class="code console"&gt;&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get pods
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;NAME                            READY     STATUS    RESTARTS   AGE&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-3"&gt;&lt;/a&gt;&lt;span class="go"&gt;redis-master-2576299852-iwf15   1/1       Running   0          52m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-4"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-dashboard-1288919851-n10qs   1/1       Running   0          20m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-5"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-bekby      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-6"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-cecxu      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-7"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-lnxha      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-8"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-nc474      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-9"&gt;&lt;/a&gt;&lt;span class="go"&gt;rq-worker-3416405364-ztmuq      1/1       Running   0          45m&lt;/span&gt;
&lt;a name="rest_code_615f03d40c6b4265882fdc33a0c3fbf4-10"&gt;&lt;/a&gt;&lt;span class="go"&gt;web-flask-338777398-21dli       1/1       Running   0          47m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="alternative-solution-integrate-the-dashboard-in-our-flask-app"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/#id21"&gt;5.5   Alternative Solution: Integrate the Dashboard in our Flask app&lt;/a&gt;&lt;/h3&gt;
&lt;pre class="code diff"&gt;&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask/app.py b/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index af6ec48..ec7c1cd 100644&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask/app.py&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -4,12 +4,16 @@ from rq import Queue&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-7"&gt;&lt;/a&gt; from random import randrange
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-9"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-from settings import REDIS_HOST, REDIS_PORT&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-10"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-11"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+import rq_dashboard&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-12"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+import settings&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-14"&gt;&lt;/a&gt; app = Flask(__name__)
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-15"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.config.from_object(rq_dashboard.default_settings)&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-16"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.config.from_object(settings)&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-17"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+app.register_blueprint(rq_dashboard.blueprint, url_prefix='/dashboard')&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-18"&gt;&lt;/a&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-19"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-q = Queue(connection=StrictRedis(host=REDIS_HOST, port=REDIS_PORT))&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-20"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+q = Queue(connection=StrictRedis(host=settings.REDIS_HOST,&lt;/span&gt;
&lt;a name="rest_code_2fad0d47351f4fe5968dacf764460e1b-21"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+                                 port=settings.REDIS_PORT))&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code diff"&gt;&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask/requirements.txt b/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index 17dba2a..fcb5d58 100644&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask/requirements.txt&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -1,3 +1,4 @@&lt;/span&gt;
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-6"&gt;&lt;/a&gt; flask
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-7"&gt;&lt;/a&gt; redis
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-8"&gt;&lt;/a&gt; rq
&lt;a name="rest_code_7272cd50e3fb4d60b64d4cd3662e78ae-9"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+rq-dashboard&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_173d394afbe0465bb6acc2328736e358-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; docker build -t tiao/web-flask-rq:v2 web-flask
&lt;/pre&gt;&lt;pre class="code diff"&gt;&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-1"&gt;&lt;/a&gt;&lt;span class="gh"&gt;diff --git a/web-flask-deployment.yaml b/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-2"&gt;&lt;/a&gt;&lt;span class="gh"&gt;index a4524e6..2dc5356 100644&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-3"&gt;&lt;/a&gt;&lt;span class="gd"&gt;--- a/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-4"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+++ b/web-flask-deployment.yaml&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-5"&gt;&lt;/a&gt;&lt;span class="gu"&gt;@@ -24,7 +24,7 @@ spec:&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-6"&gt;&lt;/a&gt;       - env:
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-7"&gt;&lt;/a&gt;         - name: GET_HOSTS_FROM
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-8"&gt;&lt;/a&gt;           value: dns
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-9"&gt;&lt;/a&gt;&lt;span class="gd"&gt;-        image: tiao/web-flask-rq:v1&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-10"&gt;&lt;/a&gt;&lt;span class="gi"&gt;+        image: tiao/web-flask-rq:v2&lt;/span&gt;
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-11"&gt;&lt;/a&gt;         name: web-flask
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-12"&gt;&lt;/a&gt;         ports:
&lt;a name="rest_code_b28206b212724ceab551c14f6ea8f307-13"&gt;&lt;/a&gt;         - containerPort: 8080
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_3abb47cbc4d94b6cabd44b8aa473e5fe-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl apply -f web-flask-deployment.yaml
&lt;a name="rest_code_3abb47cbc4d94b6cabd44b8aa473e5fe-2"&gt;&lt;/a&gt;&lt;span class="go"&gt;deployment "web-flask" configured&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_d7bb0e09c0ef40c7ba791d558aa789f4-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; kubectl get deployment web-flask --output&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'jsonpath={.spec.template.spec.containers[*].image}'&lt;/span&gt;
&lt;a name="rest_code_d7bb0e09c0ef40c7ba791d558aa789f4-2"&gt;&lt;/a&gt;&lt;span class="gp"&gt;tiao/web-flask-rq:v2%&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code console"&gt;&lt;a name="rest_code_ca1bc62c1a5e480499a6047402d39f02-1"&gt;&lt;/a&gt;&lt;span class="gp"&gt;$&lt;/span&gt; open &lt;span class="s2"&gt;"http://&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;address&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/dashboard"&lt;/span&gt;
&lt;/pre&gt;&lt;a class="reference external image-reference" href="http://louistiao.me/images/rq-dashboard-failed-flask.png"&gt;&lt;img alt="../../images/rq-dashboard-failed-flask.thumbnail.png" class="align-center" src="http://louistiao.me/images/rq-dashboard-failed-flask.thumbnail.png"&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>docker</category><category>flask</category><category>jsonpath</category><category>kubernetes</category><category>redis</category><category>rq</category><category>yaml</category><guid>http://louistiao.me/posts/walkthrough-deploying-a-flask-app-with-redis-queue-rq-workers-and-dashboard-using-kubernetes/</guid><pubDate>Fri, 01 Jul 2016 04:12:07 GMT</pubDate></item></channel></rss>